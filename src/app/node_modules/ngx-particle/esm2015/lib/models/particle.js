import { getColor, createSvgImg } from './utils';
export class Particle {
    constructor(_canvasParams, _params, _tmpParams, color, opacity, position) {
        this._canvasParams = _canvasParams;
        this._params = _params;
        this._tmpParams = _tmpParams;
        this._setupSize();
        this._setupPosition(position);
        this._setupColor(color);
        this._setupOpacity();
        this._setupAnimation();
    }
    _setupSize() {
        this.radius = (this._params.particles.size.random ? Math.random() : 1) * this._params.particles.size.value;
        if (this._params.particles.size.anim.enable) {
            this.size_status = false;
            this.vs = this._params.particles.size.anim.speed / 100;
            if (!this._params.particles.size.anim.sync)
                this.vs = this.vs * Math.random();
        }
    }
    _setupPosition(position) {
        this.x = position ? position.x : Math.random() * this._canvasParams.width;
        this.y = position ? position.y : Math.random() * this._canvasParams.height;
        if (this.x > this._canvasParams.width - this.radius * 2) {
            this.x = this.x - this.radius;
        }
        else if (this.x < this.radius * 2) {
            this.x = this.x + this.radius;
        }
        if (this.y > this._canvasParams.height - this.radius * 2) {
            this.y = this.y - this.radius;
        }
        else if (this.y < this.radius * 2) {
            this.y = this.y + this.radius;
        }
        if (this._params.particles.move.bounce) {
            this._checkOverlap(this, position);
        }
    }
    _checkOverlap(p1, position) {
        let { particles } = this._params;
        particles.array.forEach((particle) => {
            let p2 = particle;
            let dx = p1.x - p2.x;
            let dy = p1.y - p2.y;
            let dist = Math.sqrt(dx * dx + dy * dy);
            if (dist <= p1.radius + p2.radius) {
                p1.x = position ? position.x : Math.random() * this._canvasParams.width;
                p1.y = position ? position.y : Math.random() * this._canvasParams.height;
                this._checkOverlap(p1);
            }
        });
    }
    _setupColor(color) {
        this.color = getColor(color.value);
    }
    _setupOpacity() {
        this.opacity = (this._params.particles.opacity.random ? Math.random() : 1) * this._params.particles.opacity.value;
        if (this._params.particles.opacity.anim.enable) {
            this.opacity_status = false;
            this.vo = this._params.particles.opacity.anim.speed / 100;
            if (!this._params.particles.opacity.anim.sync) {
                this.vo = this.vo * Math.random();
            }
        }
    }
    _setupAnimation() {
        let velbase = null;
        switch (this._params.particles.move.direction) {
            case 'top':
                velbase = { x: 0, y: -1 };
                break;
            case 'top-right':
                velbase = { x: 0.5, y: -0.5 };
                break;
            case 'right':
                velbase = { x: 1, y: 0 };
                break;
            case 'bottom-right':
                velbase = { x: 0.5, y: 0.5 };
                break;
            case 'bottom':
                velbase = { x: 0, y: 1 };
                break;
            case 'bottom-left':
                velbase = { x: -0.5, y: 1 };
                break;
            case 'left':
                velbase = { x: -1, y: 0 };
                break;
            case 'top-left':
                velbase = { x: -0.5, y: -0.5 };
                break;
            default:
                velbase = { x: 0, y: 0 };
                break;
        }
        if (this._params.particles.move.straight) {
            this.vx = velbase.x;
            this.vy = velbase.y;
            if (this._params.particles.move.random) {
                this.vx = this.vx * (Math.random());
                this.vy = this.vy * (Math.random());
            }
        }
        else {
            this.vx = velbase.x + Math.random() - 0.5;
            this.vy = velbase.y + Math.random() - 0.5;
        }
        this.vx_i = this.vx;
        this.vy_i = this.vy;
        let shape_type = this._params.particles.shape.type;
        if (typeof (shape_type) == 'object') {
            if (shape_type instanceof Array) {
                let shape_selected = shape_type[Math.floor(Math.random() * shape_type.length)];
                this.shape = shape_selected;
            }
        }
        else {
            this.shape = shape_type;
        }
        if (this.shape == 'image') {
            let sh = this._params.particles.shape;
            this.img = {
                src: sh.image.src,
                ratio: sh.image.width / sh.image.height
            };
            if (!this.img.ratio)
                this.img.ratio = 1;
            if (this._tmpParams.img_type == 'svg' && this._tmpParams.source_svg != undefined) {
                createSvgImg(this, this._tmpParams);
                if (this._tmpParams.pushing) {
                    this.img.loaded = false;
                }
            }
        }
    }
    _drawShape(c, startX, startY, sideLength, sideCountNumerator, sideCountDenominator) {
        let sideCount = sideCountNumerator * sideCountDenominator;
        let decimalSides = sideCountNumerator / sideCountDenominator;
        let interiorAngleDegrees = (180 * (decimalSides - 2)) / decimalSides;
        let interiorAngle = Math.PI - Math.PI * interiorAngleDegrees / 180;
        c.save();
        c.beginPath();
        c.translate(startX, startY);
        c.moveTo(0, 0);
        for (let i = 0; i < sideCount; i++) {
            c.lineTo(sideLength, 0);
            c.translate(sideLength, 0);
            c.rotate(interiorAngle);
        }
        c.fill();
        c.restore();
    }
    draw() {
        let { particles } = this._params;
        let radius;
        if (this.radius_bubble != undefined) {
            radius = this.radius_bubble;
        }
        else {
            radius = this.radius;
        }
        let opacity;
        if (this.opacity_bubble != undefined) {
            opacity = this.opacity_bubble;
        }
        else {
            opacity = this.opacity;
        }
        let color_value;
        if (this.color.rgb) {
            let { r, g, b } = this.color.rgb;
            color_value = `rgba( ${r}, ${g}, ${b}, ${opacity} )`;
        }
        else {
            let { h, s, l } = this.color.hsl;
            color_value = `hsla( ${h}, ${s}, ${l}, ${opacity} )`;
        }
        this._canvasParams.ctx.fillStyle = color_value;
        this._canvasParams.ctx.beginPath();
        switch (this.shape) {
            case 'circle':
                this._canvasParams.ctx.arc(this.x, this.y, radius, 0, Math.PI * 2, false);
                break;
            case 'edge':
                this._canvasParams.ctx.rect(this.x - radius, this.y - radius, radius * 2, radius * 2);
                break;
            case 'triangle':
                this._drawShape(this._canvasParams.ctx, this.x - radius, this.y + radius / 1.66, radius * 2, 3, 2);
                break;
            case 'polygon':
                this._drawShape(this._canvasParams.ctx, this.x - radius / (this._params.particles.shape.polygon.nb_sides / 3.5), this.y - radius / (2.66 / 3.5), radius * 2.66 / (this._params.particles.shape.polygon.nb_sides / 3), this._params.particles.shape.polygon.nb_sides, 1);
                break;
            case 'star':
                this._drawShape(this._canvasParams.ctx, this.x - radius * 2 / (this._params.particles.shape.polygon.nb_sides / 4), this.y - radius / (2 * 2.66 / 3.5), radius * 2 * 2.66 / (this._params.particles.shape.polygon.nb_sides / 3), this._params.particles.shape.polygon.nb_sides, 2);
                break;
            case 'image':
                let draw = (img_obj) => {
                    this._canvasParams.ctx.drawImage(img_obj, this.x - radius, this.y - radius, radius * 2, radius * 2 / this.img.ratio);
                };
                let img_obj;
                if (this._tmpParams.img_type == 'svg') {
                    img_obj = this.img.obj;
                }
                else {
                    img_obj = this._tmpParams.img_obj;
                }
                if (img_obj)
                    draw(img_obj);
                break;
        }
        this._canvasParams.ctx.closePath();
        if (this._params.particles.shape.stroke.width > 0) {
            this._canvasParams.ctx.strokeStyle = this._params.particles.shape.stroke.color;
            this._canvasParams.ctx.lineWidth = this._params.particles.shape.stroke.width;
            this._canvasParams.ctx.stroke();
        }
        this._canvasParams.ctx.fill();
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFydGljbGUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gtcGFydGljbGUvIiwic291cmNlcyI6WyJsaWIvbW9kZWxzL3BhcnRpY2xlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxRQUFRLEVBQUUsWUFBWSxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBRWpELE1BQU0sT0FBTyxRQUFRO0lBeUJqQixZQUFvQixhQUE0QixFQUFVLE9BQWdCLEVBQVUsVUFBc0IsRUFBRSxLQUFXLEVBQUUsT0FBYSxFQUFFLFFBQW9DO1FBQXhKLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBQVUsWUFBTyxHQUFQLE9BQU8sQ0FBUztRQUFVLGVBQVUsR0FBVixVQUFVLENBQVk7UUFDdEcsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQ2xCLElBQUksQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDOUIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN4QixJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDckIsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO0lBQzNCLENBQUM7SUFFTyxVQUFVO1FBQ2QsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQztRQUMzRyxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ3pDLElBQUksQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFDO1lBQ3pCLElBQUksQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsR0FBRyxDQUFDO1lBQ3ZELElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUk7Z0JBQ3RDLElBQUksQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7U0FDekM7SUFDTCxDQUFDO0lBRU8sY0FBYyxDQUFDLFFBQW9DO1FBQ3ZELElBQUksQ0FBQyxDQUFDLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUM7UUFDMUUsSUFBSSxDQUFDLENBQUMsR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQztRQUUzRSxJQUFJLElBQUksQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDckQsSUFBSSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7U0FDakM7YUFBTSxJQUFJLElBQUksQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDakMsSUFBSSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7U0FDakM7UUFDRCxJQUFJLElBQUksQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDdEQsSUFBSSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMs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LENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQztZQUMvRSxJQUFJLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7WUFDN0UsSUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLENBQUM7U0FDbkM7UUFFRCxJQUFJLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNsQyxDQUFDO0NBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJQ2FudmFzUGFyYW1zLCBJUGFyYW1zLCBJVG1wUGFyYW1zIH0gZnJvbSAnLi9pbnRlcmZhY2VzJztcclxuaW1wb3J0IHsgZ2V0Q29sb3IsIGNyZWF0ZVN2Z0ltZyB9IGZyb20gJy4vdXRpbHMnO1xyXG5cclxuZXhwb3J0IGNsYXNzIFBhcnRpY2xlIHtcclxuICAgIHJhZGl1czogbnVtYmVyO1xyXG4gICAgcmFkaXVzX2J1YmJsZTogbnVtYmVyO1xyXG4gICAgc2l6ZV9zdGF0dXM6IGJvb2xlYW47XHJcbiAgICB2czogbnVtYmVyO1xyXG5cclxuICAgIHg6IG51bWJlcjtcclxuICAgIHk6IG51bWJlcjtcclxuICAgIGNvbG9yOiBhbnk7XHJcblxyXG4gICAgb3BhY2l0eTogbnVtYmVyO1xyXG4gICAgb3BhY2l0eV9idWJibGU6IG51bWJlcjtcclxuICAgIG9wYWNpdHlfc3RhdHVzOiBib29sZWFuO1xyXG4gICAgdm86IG51bWJlcjtcclxuXHJcbiAgICB2eDogbnVtYmVyO1xyXG4gICAgdnk6IG51bWJlcjtcclxuXHJcbiAgICB2eF9pOiBudW1iZXI7XHJcbiAgICB2eV9pOiBudW1iZXI7XHJcblxyXG4gICAgc2hhcGU6IHN0cmluZztcclxuXHJcbiAgICBpbWc6IHsgc3JjOiBzdHJpbmc7IHJhdGlvOiBudW1iZXI7IGxvYWRlZD86IGJvb2xlYW47IG9iaj86IGFueTsgfTtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIF9jYW52YXNQYXJhbXM6IElDYW52YXNQYXJhbXMsIHByaXZhdGUgX3BhcmFtczogSVBhcmFtcywgcHJpdmF0ZSBfdG1wUGFyYW1zOiBJVG1wUGFyYW1zLCBjb2xvcj86IGFueSwgb3BhY2l0eT86IGFueSwgcG9zaXRpb24/OiB7IHg6IG51bWJlcjsgeTogbnVtYmVyOyB9KSB7XHJcbiAgICAgICAgdGhpcy5fc2V0dXBTaXplKCk7XHJcbiAgICAgICAgdGhpcy5fc2V0dXBQb3NpdGlvbihwb3NpdGlvbik7XHJcbiAgICAgICAgdGhpcy5fc2V0dXBDb2xvcihjb2xvcik7XHJcbiAgICAgICAgdGhpcy5fc2V0dXBPcGFjaXR5KCk7XHJcbiAgICAgICAgdGhpcy5fc2V0dXBBbmltYXRpb24oKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF9zZXR1cFNpemUoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5yYWRpdXMgPSAodGhpcy5fcGFyYW1zLnBhcnRpY2xlcy5zaXplLnJhbmRvbSA/IE1hdGgucmFuZG9tKCkgOiAxKSAqIHRoaXMuX3BhcmFtcy5wYXJ0aWNsZXMuc2l6ZS52YWx1ZTtcclxuICAgICAgICBpZiAodGhpcy5fcGFyYW1zLnBhcnRpY2xlcy5zaXplLmFuaW0uZW5hYmxlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2l6ZV9zdGF0dXMgPSBmYWxzZTtcclxuICAgICAgICAgICAgdGhpcy52cyA9IHRoaXMuX3BhcmFtcy5wYXJ0aWNsZXMuc2l6ZS5hbmltLnNwZWVkIC8gMTAwO1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuX3BhcmFtcy5wYXJ0aWNsZXMuc2l6ZS5hbmltLnN5bmMpXHJcbiAgICAgICAgICAgICAgICB0aGlzLnZzID0gdGhpcy52cyAqIE1hdGgucmFuZG9tKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX3NldHVwUG9zaXRpb24ocG9zaXRpb24/OiB7IHg6IG51bWJlcjsgeTogbnVtYmVyOyB9KTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy54ID0gcG9zaXRpb24gPyBwb3NpdGlvbi54IDogTWF0aC5yYW5kb20oKSAqIHRoaXMuX2NhbnZhc1BhcmFtcy53aWR0aDtcclxuICAgICAgICB0aGlzLnkgPSBwb3NpdGlvbiA/IHBvc2l0aW9uLnkgOiBNYXRoLnJhbmRvbSgpICogdGhpcy5fY2FudmFzUGFyYW1zLmhlaWdodDtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMueCA+IHRoaXMuX2NhbnZhc1BhcmFtcy53aWR0aCAtIHRoaXMucmFkaXVzICogMikge1xyXG4gICAgICAgICAgICB0aGlzLnggPSB0aGlzLnggLSB0aGlzLnJhZGl1cztcclxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMueCA8IHRoaXMucmFkaXVzICogMikge1xyXG4gICAgICAgICAgICB0aGlzLnggPSB0aGlzLnggKyB0aGlzLnJhZGl1cztcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMueSA+IHRoaXMuX2NhbnZhc1BhcmFtcy5oZWlnaHQgLSB0aGlzLnJhZGl1cyAqIDIpIHtcclxuICAgICAgICAgICAgdGhpcy55ID0gdGhpcy55IC0gdGhpcy5yYWRpdXM7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnkgPCB0aGlzLnJhZGl1cyAqIDIpIHtcclxuICAgICAgICAgICAgdGhpcy55ID0gdGhpcy55ICsgdGhpcy5yYWRpdXM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5fcGFyYW1zLnBhcnRpY2xlcy5tb3ZlLmJvdW5jZSkge1xyXG4gICAgICAgICAgICB0aGlzLl9jaGVja092ZXJsYXAodGhpcywgcG9zaXRpb24pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF9jaGVja092ZXJsYXAocDE6IFBhcnRpY2xlLCBwb3NpdGlvbj86IHsgeDogbnVtYmVyOyB5OiBudW1iZXI7IH0pOiB2b2lkIHtcclxuICAgICAgICBsZXQgeyBwYXJ0aWNsZXMgfSA9IHRoaXMuX3BhcmFtcztcclxuXHJcbiAgICAgICAgcGFydGljbGVzLmFycmF5LmZvckVhY2goKHBhcnRpY2xlOiBQYXJ0aWNsZSkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgcDI6IFBhcnRpY2xlID0gcGFydGljbGU7XHJcblxyXG4gICAgICAgICAgICBsZXQgZHg6IG51bWJlciA9IHAxLnggLSBwMi54O1xyXG4gICAgICAgICAgICBsZXQgZHk6IG51bWJlciA9IHAxLnkgLSBwMi55O1xyXG4gICAgICAgICAgICBsZXQgZGlzdDogbnVtYmVyID0gTWF0aC5zcXJ0KGR4ICogZHggKyBkeSAqIGR5KTtcclxuXHJcbiAgICAgICAgICAgIGlmIChkaXN0IDw9IHAxLnJhZGl1cyArIHAyLnJhZGl1cykge1xyXG4gICAgICAgICAgICAgICAgcDEueCA9IHBvc2l0aW9uID8gcG9zaXRpb24ueCA6IE1hdGgucmFuZG9tKCkgKiB0aGlzLl9jYW52YXNQYXJhbXMud2lkdGg7XHJcbiAgICAgICAgICAgICAgICBwMS55ID0gcG9zaXRpb24gPyBwb3NpdGlvbi55IDogTWF0aC5yYW5kb20oKSAqIHRoaXMuX2NhbnZhc1BhcmFtcy5oZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jaGVja092ZXJsYXAocDEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfc2V0dXBDb2xvcihjb2xvcj86IGFueSkge1xyXG4gICAgICAgIHRoaXMuY29sb3IgPSBnZXRDb2xvcihjb2xvci52YWx1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfc2V0dXBPcGFjaXR5KCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMub3BhY2l0eSA9ICh0aGlzLl9wYXJhbXMucGFydGljbGVzLm9wYWNpdHkucmFuZG9tID8gTWF0aC5yYW5kb20oKSA6IDEpICogdGhpcy5fcGFyYW1zLnBhcnRpY2xlcy5vcGFjaXR5LnZhbHVlO1xyXG4gICAgICAgIGlmICh0aGlzLl9wYXJhbXMucGFydGljbGVzLm9wYWNpdHkuYW5pbS5lbmFibGUpIHtcclxuICAgICAgICAgICAgdGhpcy5vcGFjaXR5X3N0YXR1cyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLnZvID0gdGhpcy5fcGFyYW1zLnBhcnRpY2xlcy5vcGFjaXR5LmFuaW0uc3BlZWQgLyAxMDA7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5fcGFyYW1zLnBhcnRpY2xlcy5vcGFjaXR5LmFuaW0uc3luYykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy52byA9IHRoaXMudm8gKiBNYXRoLnJhbmRvbSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX3NldHVwQW5pbWF0aW9uKCk6IHZvaWQge1xyXG4gICAgICAgIGxldCB2ZWxiYXNlOiB7IHg6IG51bWJlcjsgeTogbnVtYmVyOyB9ID0gbnVsbDtcclxuICAgICAgICBzd2l0Y2ggKHRoaXMuX3BhcmFtcy5wYXJ0aWNsZXMubW92ZS5kaXJlY3Rpb24pIHtcclxuICAgICAgICAgICAgY2FzZSAndG9wJzpcclxuICAgICAgICAgICAgICAgIHZlbGJhc2UgPSB7IHg6IDAsIHk6IC0xIH07XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAndG9wLXJpZ2h0JzpcclxuICAgICAgICAgICAgICAgIHZlbGJhc2UgPSB7IHg6IDAuNSwgeTogLTAuNSB9O1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ3JpZ2h0JzpcclxuICAgICAgICAgICAgICAgIHZlbGJhc2UgPSB7IHg6IDEsIHk6IDAgfTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdib3R0b20tcmlnaHQnOlxyXG4gICAgICAgICAgICAgICAgdmVsYmFzZSA9IHsgwqB4OiAwLjUsIHk6IDAuNSB9O1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2JvdHRvbSc6XHJcbiAgICAgICAgICAgICAgICB2ZWxiYXNlID0geyB4OiAwLCB5OiAxIH07XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnYm90dG9tLWxlZnQnOlxyXG4gICAgICAgICAgICAgICAgdmVsYmFzZSA9IHsgeDogLTAuNSwgeTogMSB9O1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2xlZnQnOlxyXG4gICAgICAgICAgICAgICAgdmVsYmFzZSA9IHsgeDogLTEsIHk6IDAgfTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICd0b3AtbGVmdCc6XHJcbiAgICAgICAgICAgICAgICB2ZWxiYXNlID0geyDCoHg6IC0wLjUsIHk6IC0wLjUgfTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgdmVsYmFzZSA9IHsgwqB4OiAwLCB5OiAwIH07XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9wYXJhbXMucGFydGljbGVzLm1vdmUuc3RyYWlnaHQpIHtcclxuICAgICAgICAgICAgdGhpcy52eCA9IHZlbGJhc2UueDtcclxuICAgICAgICAgICAgdGhpcy52eSA9IHZlbGJhc2UueTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuX3BhcmFtcy5wYXJ0aWNsZXMubW92ZS5yYW5kb20pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudnggPSB0aGlzLnZ4ICogKE1hdGgucmFuZG9tKCkpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy52eSA9IHRoaXMudnkgKiAoTWF0aC5yYW5kb20oKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnZ4ID0gdmVsYmFzZS54ICsgTWF0aC5yYW5kb20oKSAtIDAuNTtcclxuICAgICAgICAgICAgdGhpcy52eSA9IHZlbGJhc2UueSArIE1hdGgucmFuZG9tKCkgLSAwLjU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnZ4X2kgPSB0aGlzLnZ4O1xyXG4gICAgICAgIHRoaXMudnlfaSA9IHRoaXMudnk7XHJcblxyXG4gICAgICAgIGxldCBzaGFwZV90eXBlOiBhbnkgPSB0aGlzLl9wYXJhbXMucGFydGljbGVzLnNoYXBlLnR5cGU7XHJcblxyXG4gICAgICAgIGlmICh0eXBlb2YgKHNoYXBlX3R5cGUpID09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgICAgIGlmIChzaGFwZV90eXBlIGluc3RhbmNlb2YgQXJyYXkpIHtcclxuICAgICAgICAgICAgICAgIGxldCBzaGFwZV9zZWxlY3RlZDogc3RyaW5nID0gc2hhcGVfdHlwZVtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBzaGFwZV90eXBlLmxlbmd0aCldO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zaGFwZSA9IHNoYXBlX3NlbGVjdGVkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5zaGFwZSA9IHNoYXBlX3R5cGU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5zaGFwZSA9PSAnaW1hZ2UnKSB7XHJcbiAgICAgICAgICAgIGxldCBzaDogYW55ID0gdGhpcy5fcGFyYW1zLnBhcnRpY2xlcy5zaGFwZTtcclxuICAgICAgICAgICAgdGhpcy5pbWcgPSB7XHJcbiAgICAgICAgICAgICAgICBzcmM6IHNoLmltYWdlLnNyYyxcclxuICAgICAgICAgICAgICAgIHJhdGlvOiBzaC5pbWFnZS53aWR0aCAvIHNoLmltYWdlLmhlaWdodFxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgaWYgKCF0aGlzLmltZy5yYXRpbylcclxuICAgICAgICAgICAgICAgIHRoaXMuaW1nLnJhdGlvID0gMTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuX3RtcFBhcmFtcy5pbWdfdHlwZSA9PSAnc3ZnJyAmJiB0aGlzLl90bXBQYXJhbXMuc291cmNlX3N2ZyAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIGNyZWF0ZVN2Z0ltZyh0aGlzLCB0aGlzLl90bXBQYXJhbXMpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX3RtcFBhcmFtcy5wdXNoaW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbWcubG9hZGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfZHJhd1NoYXBlKGM6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCwgc3RhcnRYOiBudW1iZXIsIHN0YXJ0WTogbnVtYmVyLCBzaWRlTGVuZ3RoOiBudW1iZXIsIHNpZGVDb3VudE51bWVyYXRvcjogbnVtYmVyLCBzaWRlQ291bnREZW5vbWluYXRvcjogbnVtYmVyKTogdm9pZCB7XHJcbiAgICAgICAgbGV0IHNpZGVDb3VudDogbnVtYmVyID0gc2lkZUNvdW50TnVtZXJhdG9yICogc2lkZUNvdW50RGVub21pbmF0b3I7XHJcbiAgICAgICAgbGV0IGRlY2ltYWxTaWRlczogbnVtYmVyID0gc2lkZUNvdW50TnVtZXJhdG9yIC8gc2lkZUNvdW50RGVub21pbmF0b3I7XHJcbiAgICAgICAgbGV0IGludGVyaW9yQW5nbGVEZWdyZWVzOiBudW1iZXIgPSAoMTgwICogKGRlY2ltYWxTaWRlcyAtIDIpKSAvIGRlY2ltYWxTaWRlcztcclxuICAgICAgICBsZXQgaW50ZXJpb3JBbmdsZTogbnVtYmVyID0gTWF0aC5QSSAtIE1hdGguUEkgKiBpbnRlcmlvckFuZ2xlRGVncmVlcyAvIDE4MDtcclxuXHJcbiAgICAgICAgYy5zYXZlKCk7XHJcbiAgICAgICAgYy5iZWdpblBhdGgoKTtcclxuICAgICAgICBjLnRyYW5zbGF0ZShzdGFydFgsIHN0YXJ0WSk7XHJcbiAgICAgICAgYy5tb3ZlVG8oMCwgMCk7XHJcblxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2lkZUNvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgYy5saW5lVG8oc2lkZUxlbmd0aCwgMCk7XHJcbiAgICAgICAgICAgIGMudHJhbnNsYXRlKHNpZGVMZW5ndGgsIDApO1xyXG4gICAgICAgICAgICBjLnJvdGF0ZShpbnRlcmlvckFuZ2xlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGMuZmlsbCgpO1xyXG4gICAgICAgIGMucmVzdG9yZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBkcmF3KCk6IHZvaWQge1xyXG4gICAgICAgIGxldCB7IHBhcnRpY2xlcyB9ID0gdGhpcy5fcGFyYW1zO1xyXG5cclxuICAgICAgICBsZXQgcmFkaXVzOiBudW1iZXI7XHJcbiAgICAgICAgaWYgKHRoaXMucmFkaXVzX2J1YmJsZSAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgcmFkaXVzID0gdGhpcy5yYWRpdXNfYnViYmxlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJhZGl1cyA9IHRoaXMucmFkaXVzO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IG9wYWNpdHk6IG51bWJlcjtcclxuICAgICAgICBpZiAodGhpcy5vcGFjaXR5X2J1YmJsZSAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgb3BhY2l0eSA9IHRoaXMub3BhY2l0eV9idWJibGU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgb3BhY2l0eSA9IHRoaXMub3BhY2l0eTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBjb2xvcl92YWx1ZTogc3RyaW5nO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5jb2xvci5yZ2IpIHtcclxuICAgICAgICAgICAgbGV0IHsgciwgZywgYiB9ID0gdGhpcy5jb2xvci5yZ2I7XHJcbiAgICAgICAgICAgIGNvbG9yX3ZhbHVlID0gYHJnYmEoICR7cn0sICR7Z30sICR7Yn0sICR7b3BhY2l0eX0gKWA7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbGV0IHsgaCwgcywgbCB9ID0gdGhpcy5jb2xvci5oc2w7XHJcbiAgICAgICAgICAgIGNvbG9yX3ZhbHVlID0gYGhzbGEoICR7aH0sICR7c30sICR7bH0sICR7b3BhY2l0eX0gKWA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLl9jYW52YXNQYXJhbXMuY3R4LmZpbGxTdHlsZSA9IGNvbG9yX3ZhbHVlO1xyXG4gICAgICAgIHRoaXMuX2NhbnZhc1BhcmFtcy5jdHguYmVnaW5QYXRoKCk7XHJcblxyXG4gICAgICAgIHN3aXRjaCAodGhpcy5zaGFwZSkge1xyXG4gICAgICAgICAgICBjYXNlICdjaXJjbGUnOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fY2FudmFzUGFyYW1zLmN0eC5hcmModGhpcy54LCB0aGlzLnksIHJhZGl1cywgMCwgTWF0aC5QSSAqIDIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSAnZWRnZSc6XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jYW52YXNQYXJhbXMuY3R4LnJlY3QodGhpcy54IC0gcmFkaXVzLCB0aGlzLnkgLSByYWRpdXMsIHJhZGl1cyAqIDIsIHJhZGl1cyAqIDIpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlICd0cmlhbmdsZSc6XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9kcmF3U2hhcGUodGhpcy5fY2FudmFzUGFyYW1zLmN0eCwgdGhpcy54IC0gcmFkaXVzLCB0aGlzLnkgKyByYWRpdXMgLyAxLjY2LCByYWRpdXMgKiAyLCAzLCAyKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSAncG9seWdvbic6XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9kcmF3U2hhcGUoXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2FudmFzUGFyYW1zLmN0eCxcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnggLSByYWRpdXMgLyAodGhpcy5fcGFyYW1zLnBhcnRpY2xlcy5zaGFwZS5wb2x5Z29uLm5iX3NpZGVzIC8gMy41KSxcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnkgLSByYWRpdXMgLyAoMi42NiAvIDMuNSksXHJcbiAgICAgICAgICAgICAgICAgICAgcmFkaXVzICogMi42NiAvICh0aGlzLl9wYXJhbXMucGFydGljbGVzLnNoYXBlLnBvbHlnb24ubmJfc2lkZXMgLyAzKSxcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9wYXJhbXMucGFydGljbGVzLnNoYXBlLnBvbHlnb24ubmJfc2lkZXMsXHJcbiAgICAgICAgICAgICAgICAgICAgMVxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSAnc3Rhcic6XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9kcmF3U2hhcGUoXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2FudmFzUGFyYW1zLmN0eCxcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnggLSByYWRpdXMgKiAyIC8gKHRoaXMuX3BhcmFtcy5wYXJ0aWNsZXMuc2hhcGUucG9seWdvbi5uYl9zaWRlcyAvIDQpLFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMueSAtIHJhZGl1cyAvICgyICogMi42NiAvIDMuNSksXHJcbiAgICAgICAgICAgICAgICAgICAgcmFkaXVzICogMiAqIDIuNjYgLyAodGhpcy5fcGFyYW1zLnBhcnRpY2xlcy5zaGFwZS5wb2x5Z29uLm5iX3NpZGVzIC8gMyksXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGFyYW1zLnBhcnRpY2xlcy5zaGFwZS5wb2x5Z29uLm5iX3NpZGVzLFxyXG4gICAgICAgICAgICAgICAgICAgIDJcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgJ2ltYWdlJzpcclxuICAgICAgICAgICAgICAgIGxldCBkcmF3OiAoaW1nX29iajogYW55KSA9PiB2b2lkID1cclxuICAgICAgICAgICAgICAgICAgICAoaW1nX29iaikgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9jYW52YXNQYXJhbXMuY3R4LmRyYXdJbWFnZShcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltZ19vYmosXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnggLSByYWRpdXMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnkgLSByYWRpdXMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByYWRpdXMgKiAyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFkaXVzICogMiAvIHRoaXMuaW1nLnJhdGlvXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIGxldCBpbWdfb2JqOiBhbnk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX3RtcFBhcmFtcy5pbWdfdHlwZSA9PSAnc3ZnJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGltZ19vYmogPSB0aGlzLmltZy5vYmo7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGltZ19vYmogPSB0aGlzLl90bXBQYXJhbXMuaW1nX29iajtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoaW1nX29iailcclxuICAgICAgICAgICAgICAgICAgICBkcmF3KGltZ19vYmopO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLl9jYW52YXNQYXJhbXMuY3R4LmNsb3NlUGF0aCgpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5fcGFyYW1zLnBhcnRpY2xlcy5zaGFwZS5zdHJva2Uud2lkdGggPiAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2NhbnZhc1BhcmFtcy5jdHguc3Ryb2tlU3R5bGUgPSB0aGlzLl9wYXJhbXMucGFydGljbGVzLnNoYXBlLnN0cm9rZS5jb2xvcjtcclxuICAgICAgICAgICAgdGhpcy5fY2FudmFzUGFyYW1zLmN0eC5saW5lV2lkdGggPSB0aGlzLl9wYXJhbXMucGFydGljbGVzLnNoYXBlLnN0cm9rZS53aWR0aDtcclxuICAgICAgICAgICAgdGhpcy5fY2FudmFzUGFyYW1zLmN0eC5zdHJva2UoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuX2NhbnZhc1BhcmFtcy5jdHguZmlsbCgpO1xyXG4gICAgfVxyXG59Il19