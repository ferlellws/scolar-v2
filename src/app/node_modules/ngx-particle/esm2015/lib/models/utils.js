export const hexToRgb = (hex) => {
    let shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
    hex = hex.replace(shorthandRegex, (m, r, g, b) => {
        return r + r + g + g + b + b;
    });
    let result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
    return result ? {
        r: parseInt(result[1], 16),
        g: parseInt(result[2], 16),
        b: parseInt(result[3], 16)
    } : null;
};
export const clamp = (number, min, max) => {
    return Math.min(Math.max(number, min), max);
};
export const isInArray = (value, array) => {
    return array.indexOf(value) > -1;
};
export const deepExtend = function (destination, source) {
    for (let property in source) {
        if (source[property] &&
            source[property].constructor &&
            source[property].constructor === Object) {
            destination[property] = destination[property] || {};
            deepExtend(destination[property], source[property]);
        }
        else {
            destination[property] = source[property];
        }
    }
    return destination;
};
export const getColor = (colorObject) => {
    let color = {};
    if (typeof (colorObject) == 'object') {
        if (colorObject instanceof Array) {
            let selectedColor = colorObject[Math.floor(Math.random() * colorObject.length)];
            color.rgb = hexToRgb(selectedColor);
        }
        else {
            let { r, g, b } = colorObject;
            if (r !== undefined && g !== undefined && b !== undefined) {
                color.rgb = { r, g, b };
            }
            else {
                let { h, s, l } = colorObject;
                if (h !== undefined && g !== undefined && b !== undefined) {
                    color.hsl = { h, s, l };
                }
            }
        }
    }
    else if (colorObject == 'random') {
        color.rgb = {
            r: (Math.floor(Math.random() * 255) + 1),
            g: (Math.floor(Math.random() * 255) + 1),
            b: (Math.floor(Math.random() * 255) + 1)
        };
    }
    else if (typeof (colorObject) == 'string') {
        color.rgb = hexToRgb(colorObject);
    }
    return color;
};
export const getDefaultParams = () => {
    return {
        particles: {
            number: {
                value: 100,
                density: {
                    enable: true,
                    value_area: 800
                }
            },
            color: {
                value: '#FFF'
            },
            shape: {
                type: 'circle',
                stroke: {
                    width: 0,
                    color: '#000000'
                },
                polygon: {
                    nb_sides: 5
                },
                image: {
                    src: '',
                    width: 100,
                    height: 100
                }
            },
            opacity: {
                value: 0.5,
                random: false,
                anim: {
                    enable: true,
                    speed: 1,
                    opacity_min: 0.1,
                    sync: false
                }
            },
            size: {
                value: 3,
                random: true,
                anim: {
                    enable: false,
                    speed: 40,
                    size_min: 0,
                    sync: false
                }
            },
            line_linked: {
                enable: true,
                distance: 150,
                color: '#FFF',
                opacity: 0.6,
                width: 1,
                shadow: {
                    enable: false,
                    blur: 5,
                    color: 'lime'
                }
            },
            move: {
                enable: true,
                speed: 3,
                direction: 'none',
                random: false,
                straight: false,
                out_mode: 'out',
                bounce: true,
                attract: {
                    enable: false,
                    rotateX: 3000,
                    rotateY: 3000
                }
            },
            array: []
        },
        interactivity: {
            detect_on: 'canvas',
            events: {
                onhover: {
                    enable: true,
                    mode: 'grab'
                },
                onclick: {
                    enable: true,
                    mode: 'push'
                },
                resize: true
            },
            modes: {
                grab: {
                    distance: 200,
                    line_linked: {
                        opacity: 1
                    }
                },
                bubble: {
                    distance: 200,
                    size: 80,
                    duration: 0.4
                },
                repulse: {
                    distance: 200,
                    duration: 0.4
                },
                push: {
                    particles_nb: 4
                },
                remove: {
                    particles_nb: 2
                }
            },
            mouse: {}
        },
        retina_detect: true
    };
};
export function loadImg(params, tmp) {
    let { particles } = params;
    tmp.img_error = undefined;
    if (particles.shape.type == 'image' && particles.shape.image.src != '') {
        if (tmp.img_type == 'svg') {
            let xhr = new XMLHttpRequest();
            xhr.open('GET', particles.shape.image.src);
            xhr.onreadystatechange = (data) => {
                if (xhr.readyState == 4) {
                    if (xhr.status == 200) {
                        tmp.source_svg = data.currentTarget.response;
                        if (tmp.source_svg == undefined) {
                            let check;
                            tmp.checkAnimFrame = requestAnimationFrame(check);
                        }
                    }
                    else {
                        tmp.img_error = true;
                        throw "Error : image not found";
                    }
                }
            };
            xhr.send();
        }
        else {
            let img = new Image();
            img.addEventListener('load', () => {
                tmp.img_obj = img;
                cancelAnimationFrame(tmp.checkAnimFrame);
            });
            img.src = particles.shape.image.src;
        }
    }
    else {
        tmp.img_error = true;
        throw "Error : no image.src";
    }
}
export function createSvgImg(particle, tmp) {
    let svgXml = tmp.source_svg;
    let rgbHex = /#([0-9A-F]{3,6})/gi;
    let coloredSvgXml = svgXml.replace(rgbHex, (m, r, g, b) => {
        let color_value;
        if (particle.color.rgb) {
            let { r, g, b } = particle.color.rgb;
            color_value = `rgba( ${r}, ${g}, ${b}, ${particle.opacity} )`;
        }
        else {
            let { h, s, l } = particle.color.hsl;
            color_value = `rgba( ${h}, ${s}, ${l}, ${particle.opacity} )`;
        }
        return color_value;
    });
    let svg = new Blob([coloredSvgXml], {
        type: 'image/svg+xml;charset=utf-8'
    });
    let DOMURL = window.URL || window;
    let url = DOMURL.createObjectURL(svg);
    let img = new Image();
    img.addEventListener('load', () => {
        particle.img.obj = img;
        particle.img.loaded = true;
        DOMURL.revokeObjectURL(url);
        tmp.count_svg++;
    });
    img.src = url;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gtcGFydGljbGUvIiwic291cmNlcyI6WyJsaWIvbW9kZWxzL3V0aWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQWVBLE1BQU0sQ0FBQyxNQUFNLFFBQVEsR0FDakIsQ0FBQyxHQUFHLEVBQUUsRUFBRTtJQUNKLElBQUksY0FBYyxHQUFHLGtDQUFrQyxDQUFDO0lBQ3hELEdBQUcsR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDLGNBQWMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFO1FBQzdDLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDakMsQ0FBQyxDQUFDLENBQUM7SUFDSCxJQUFJLE1BQU0sR0FBRywyQ0FBMkMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDbkUsT0FBTyxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBQ1osQ0FBQyxFQUFFLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDO1FBQzFCLENBQUMsRUFBRSxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQztRQUMxQixDQUFDLEVBQUUsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUM7S0FDN0IsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO0FBQ2IsQ0FBQyxDQUFDO0FBRU4sTUFBTSxDQUFDLE1BQU0sS0FBSyxHQUNkLENBQUMsTUFBTSxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsRUFBRTtJQUNqQixPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7QUFDaEQsQ0FBQyxDQUFDO0FBRU4sTUFBTSxDQUFD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Q0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDO1lBQ3JDLFdBQVcsR0FBRyxTQUFTLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxLQUFLLFFBQVEsQ0FBQyxPQUFPLElBQUksQ0FBQztTQUNqRTtRQUNELE9BQU8sV0FBVyxDQUFDO0lBQ3ZCLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxHQUFHLEdBQVMsSUFBSSxJQUFJLENBQUMsQ0FBQyxhQUFhLENBQUMsRUFBRTtRQUN0QyxJQUFJLEVBQUUsNkJBQTZCO0tBQ3RDLENBQUMsQ0FBQztJQUVILElBQUksTUFBTSxHQUFRLE1BQU0sQ0FBQyxHQUFHLElBQUksTUFBTSxDQUFDO0lBQ3ZDLElBQUksR0FBRyxHQUFRLE1BQU0sQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLENBQUM7SUFFM0MsSUFBSSxHQUFHLEdBQUcsSUFBSSxLQUFLLEVBQUUsQ0FBQztJQUN0QixHQUFHLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxFQUFFLEdBQUcsRUFBRTtRQUM5QixRQUFRLENBQUMsR0FBRyxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUM7UUFDdkIsUUFBUSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDO1FBQzNCLE1BQU0sQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDNUIsR0FBRyxDQUFDLFNBQVMsRUFBRSxDQUFDO0lBQ3BCLENBQUMsQ0FBQyxDQUFDO0lBQ0gsR0FBRyxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUM7QUFDbEIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IElQYXJhbXMsIElUbXBQYXJhbXMgfSBmcm9tIFwiLi9pbnRlcmZhY2VzXCI7XHJcbmltcG9ydCB7IFBhcnRpY2xlIH0gZnJvbSBcIi4vcGFydGljbGVcIjtcclxuXHJcbmV4cG9ydCB0eXBlIFJHQiA9IHtcclxuXHRyOiBudW1iZXI7XHJcblx0ZzogbnVtYmVyO1xyXG5cdGI6IG51bWJlcjtcclxufTtcclxuXHJcbmV4cG9ydCB0eXBlIEhTTCA9IHtcclxuXHRoOiBudW1iZXI7XHJcblx0czogbnVtYmVyO1xyXG5cdGw6IG51bWJlcjtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBoZXhUb1JnYjogKGhleDogc3RyaW5nKSA9PiBSR0IgPVxyXG4gICAgKGhleCkgPT4ge1xyXG4gICAgICAgIGxldCBzaG9ydGhhbmRSZWdleCA9IC9eIz8oW2EtZlxcZF0pKFthLWZcXGRdKShbYS1mXFxkXSkkL2k7XHJcbiAgICAgICAgaGV4ID0gaGV4LnJlcGxhY2Uoc2hvcnRoYW5kUmVnZXgsIChtLCByLCBnLCBiKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiByICsgciArIGcgKyBnICsgYiArIGI7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgbGV0IHJlc3VsdCA9IC9eIz8oW2EtZlxcZF17Mn0pKFthLWZcXGRdezJ9KShbYS1mXFxkXXsyfSkkL2kuZXhlYyhoZXgpO1xyXG4gICAgICAgIHJldHVybiByZXN1bHQgPyB7XHJcbiAgICAgICAgICAgIHI6IHBhcnNlSW50KHJlc3VsdFsxXSwgMTYpLFxyXG4gICAgICAgICAgICBnOiBwYXJzZUludChyZXN1bHRbMl0sIDE2KSxcclxuICAgICAgICAgICAgYjogcGFyc2VJbnQocmVzdWx0WzNdLCAxNilcclxuICAgICAgICB9IDogbnVsbDtcclxuICAgIH07XHJcblxyXG5leHBvcnQgY29uc3QgY2xhbXA6IChudW1iZXI6IG51bWJlciwgbWluOiBudW1iZXIsIG1heDogbnVtYmVyKSA9PiBudW1iZXIgPVxyXG4gICAgKG51bWJlciwgbWluLCBtYXgpID0+IHtcclxuICAgICAgICByZXR1cm4gTWF0aC5taW4oTWF0aC5tYXgobnVtYmVyLCBtaW4pLCBtYXgpO1xyXG4gICAgfTtcclxuXHJcbmV4cG9ydCBjb25zdCBpc0luQXJyYXk6ICh2YWx1ZTogYW55LCBhcnJheTogYW55KSA9PiBib29sZWFuID1cclxuICAgICh2YWx1ZSwgYXJyYXkpID0+IHtcclxuICAgICAgICByZXR1cm4gYXJyYXkuaW5kZXhPZih2YWx1ZSkgPiAtMTtcclxuICAgIH07XHJcblxyXG5leHBvcnQgY29uc3QgZGVlcEV4dGVuZDogKGRlc3RpbmF0aW9uOiBhbnksIHNvdXJjZTogYW55KSA9PiBhbnkgPVxyXG4gICAgZnVuY3Rpb24gKGRlc3RpbmF0aW9uLCBzb3VyY2UpIHtcclxuICAgICAgICBmb3IgKGxldCBwcm9wZXJ0eSBpbiBzb3VyY2UpIHtcclxuICAgICAgICAgICAgaWYgKHNvdXJjZVtwcm9wZXJ0eV0gJiZcclxuICAgICAgICAgICAgICAgIHNvdXJjZVtwcm9wZXJ0eV0uY29uc3RydWN0b3IgJiZcclxuICAgICAgICAgICAgICAgIHNvdXJjZVtwcm9wZXJ0eV0uY29uc3RydWN0b3IgPT09IE9iamVjdCkge1xyXG4gICAgICAgICAgICAgICAgZGVzdGluYXRpb25bcHJvcGVydHldID0gZGVzdGluYXRpb25bcHJvcGVydHldIHx8IHt9O1xyXG4gICAgICAgICAgICAgICAgZGVlcEV4dGVuZChkZXN0aW5hdGlvbltwcm9wZXJ0eV0sIHNvdXJjZVtwcm9wZXJ0eV0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZGVzdGluYXRpb25bcHJvcGVydHldID0gc291cmNlW3Byb3BlcnR5XTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZGVzdGluYXRpb247XHJcbiAgICB9O1xyXG5cclxuZXhwb3J0IGNvbnN0IGdldENvbG9yOiAoY29sb3JPYmplY3Q6IGFueSkgPT4geyByZ2I/OiBSR0IsIGhzbD86IEhTTCB9ID1cclxuICAgIChjb2xvck9iamVjdCkgPT4ge1xyXG4gICAgICAgIGxldCBjb2xvcjogeyByZ2I/OiBSR0IsIGhzbD86IEhTTCB9ID0ge307XHJcbiAgICAgICAgaWYgKHR5cGVvZiAoY29sb3JPYmplY3QpID09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgICAgIGlmIChjb2xvck9iamVjdCBpbnN0YW5jZW9mIEFycmF5KSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgc2VsZWN0ZWRDb2xvcjogc3RyaW5nID0gY29sb3JPYmplY3RbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogY29sb3JPYmplY3QubGVuZ3RoKV07XHJcbiAgICAgICAgICAgICAgICBjb2xvci5yZ2IgPSBoZXhUb1JnYihzZWxlY3RlZENvbG9yKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGxldCB7IHIsIGcsIGIgfSA9IGNvbG9yT2JqZWN0O1xyXG4gICAgICAgICAgICAgICAgaWYgKHIgIT09IHVuZGVmaW5lZCAmJiBnICE9PSB1bmRlZmluZWQgJiYgYiAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29sb3IucmdiID0geyByLCBnLCBiIH07XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCB7IGgsIHMsIGwgfSA9IGNvbG9yT2JqZWN0O1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChoICE9PSB1bmRlZmluZWQgJiYgZyAhPT0gdW5kZWZpbmVkICYmIGIgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvci5oc2wgPSB7IGgsIHMsIGwgfTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgaWYgKGNvbG9yT2JqZWN0ID09ICdyYW5kb20nKSB7XHJcbiAgICAgICAgICAgIGNvbG9yLnJnYiA9IHtcclxuICAgICAgICAgICAgICAgIHI6IChNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyNTUpICsgMSksXHJcbiAgICAgICAgICAgICAgICBnOiAoTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMjU1KSArIDEpLFxyXG4gICAgICAgICAgICAgICAgYjogKE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDI1NSkgKyAxKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgKGNvbG9yT2JqZWN0KSA9PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICBjb2xvci5yZ2IgPSBoZXhUb1JnYihjb2xvck9iamVjdCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBjb2xvcjtcclxuICAgIH07XHJcblxyXG5leHBvcnQgY29uc3QgZ2V0RGVmYXVsdFBhcmFtczogKCkgPT4gSVBhcmFtcyA9XHJcbiAgICAoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcGFydGljbGVzOiB7XHJcbiAgICAgICAgICAgICAgICBudW1iZXI6IHtcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogMTAwLFxyXG4gICAgICAgICAgICAgICAgICAgIGRlbnNpdHk6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZW5hYmxlOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZV9hcmVhOiA4MDBcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgY29sb3I6IHtcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogJyNGRkYnXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgc2hhcGU6IHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnY2lyY2xlJyxcclxuICAgICAgICAgICAgICAgICAgICBzdHJva2U6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiAnIzAwMDAwMCdcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHBvbHlnb246IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmJfc2lkZXM6IDVcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIGltYWdlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNyYzogJycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiAxMDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogMTAwXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIG9wYWNpdHk6IHtcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogMC41LFxyXG4gICAgICAgICAgICAgICAgICAgIHJhbmRvbTogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgYW5pbToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmFibGU6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNwZWVkOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5X21pbjogMC4xLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzeW5jOiBmYWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBzaXplOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IDMsXHJcbiAgICAgICAgICAgICAgICAgICAgcmFuZG9tOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIGFuaW06IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZW5hYmxlOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3BlZWQ6IDQwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzaXplX21pbjogMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3luYzogZmFsc2VcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgbGluZV9saW5rZWQ6IHtcclxuICAgICAgICAgICAgICAgICAgICBlbmFibGU6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgZGlzdGFuY2U6IDE1MCxcclxuICAgICAgICAgICAgICAgICAgICBjb2xvcjogJyNGRkYnLFxyXG4gICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAuNixcclxuICAgICAgICAgICAgICAgICAgICB3aWR0aDogMSxcclxuICAgICAgICAgICAgICAgICAgICBzaGFkb3c6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZW5hYmxlOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmx1cjogNSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICdsaW1lJ1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBtb3ZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIHNwZWVkOiAzLFxyXG4gICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogJ25vbmUnLFxyXG4gICAgICAgICAgICAgICAgICAgIHJhbmRvbTogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgc3RyYWlnaHQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIG91dF9tb2RlOiAnb3V0JyxcclxuICAgICAgICAgICAgICAgICAgICBib3VuY2U6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgYXR0cmFjdDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmFibGU6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByb3RhdGVYOiAzMDAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByb3RhdGVZOiAzMDAwXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGFycmF5OiBbXVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBpbnRlcmFjdGl2aXR5OiB7XHJcbiAgICAgICAgICAgICAgICBkZXRlY3Rfb246ICdjYW52YXMnLFxyXG4gICAgICAgICAgICAgICAgZXZlbnRzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgb25ob3Zlcjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmFibGU6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGU6ICdncmFiJ1xyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgb25jbGljazoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmFibGU6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGU6ICdwdXNoJ1xyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzaXplOiB0cnVlXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgbW9kZXM6IHtcclxuICAgICAgICAgICAgICAgICAgICBncmFiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3RhbmNlOiAyMDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVfbGlua2VkOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAxXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIGJ1YmJsZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXN0YW5jZTogMjAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzaXplOiA4MCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IDAuNFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgcmVwdWxzZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXN0YW5jZTogMjAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogMC40XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBwdXNoOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlc19uYjogNFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlc19uYjogMlxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBtb3VzZToge31cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgcmV0aW5hX2RldGVjdDogdHJ1ZVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGxvYWRJbWcocGFyYW1zOiBJUGFyYW1zLCB0bXA6IElUbXBQYXJhbXMpIHtcclxuICAgIGxldCB7IHBhcnRpY2xlcyB9ID0gcGFyYW1zO1xyXG5cclxuICAgIHRtcC5pbWdfZXJyb3IgPSB1bmRlZmluZWQ7XHJcblxyXG4gICAgaWYgKHBhcnRpY2xlcy5zaGFwZS50eXBlID09ICdpbWFnZScgJiYgcGFydGljbGVzLnNoYXBlLmltYWdlLnNyYyAhPSAnJykge1xyXG4gICAgICAgIGlmICh0bXAuaW1nX3R5cGUgPT0gJ3N2ZycpIHtcclxuICAgICAgICAgICAgbGV0IHhocjogWE1MSHR0cFJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcclxuICAgICAgICAgICAgeGhyLm9wZW4oJ0dFVCcsIHBhcnRpY2xlcy5zaGFwZS5pbWFnZS5zcmMpO1xyXG4gICAgICAgICAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gKGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHhoci5yZWFkeVN0YXRlID09IDQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoeGhyLnN0YXR1cyA9PSAyMDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG1wLnNvdXJjZV9zdmcgPSBkYXRhLmN1cnJlbnRUYXJnZXQucmVzcG9uc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0bXAuc291cmNlX3N2ZyA9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjaGVjazogYW55O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG1wLmNoZWNrQW5pbUZyYW1lID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGNoZWNrKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRtcC5pbWdfZXJyb3IgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBcIkVycm9yIDogaW1hZ2Ugbm90IGZvdW5kXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB4aHIuc2VuZCgpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGxldCBpbWc6IEhUTUxJbWFnZUVsZW1lbnQgPSBuZXcgSW1hZ2UoKTtcclxuICAgICAgICAgICAgaW1nLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0bXAuaW1nX29iaiA9IGltZztcclxuICAgICAgICAgICAgICAgIGNhbmNlbEFuaW1hdGlvbkZyYW1lKHRtcC5jaGVja0FuaW1GcmFtZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBpbWcuc3JjID0gcGFydGljbGVzLnNoYXBlLmltYWdlLnNyYztcclxuICAgICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRtcC5pbWdfZXJyb3IgPSB0cnVlO1xyXG4gICAgICAgIHRocm93IFwiRXJyb3IgOiBubyBpbWFnZS5zcmNcIjtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVN2Z0ltZyhwYXJ0aWNsZTogUGFydGljbGUsIHRtcDogSVRtcFBhcmFtcyk6IHZvaWQge1xyXG4gICAgbGV0IHN2Z1htbDogc3RyaW5nID0gdG1wLnNvdXJjZV9zdmc7XHJcbiAgICBsZXQgcmdiSGV4OiBSZWdFeHAgPSAvIyhbMC05QS1GXXszLDZ9KS9naTtcclxuICAgIGxldCBjb2xvcmVkU3ZnWG1sOiBzdHJpbmcgPSBzdmdYbWwucmVwbGFjZShyZ2JIZXgsIChtLCByLCBnLCBiKSA9PiB7XHJcbiAgICAgICAgbGV0IGNvbG9yX3ZhbHVlOiBzdHJpbmc7XHJcbiAgICAgICAgaWYgKHBhcnRpY2xlLmNvbG9yLnJnYikge1xyXG4gICAgICAgICAgICBsZXQgeyByLCBnLCBiIH0gPSBwYXJ0aWNsZS5jb2xvci5yZ2I7XHJcbiAgICAgICAgICAgIGNvbG9yX3ZhbHVlID0gYHJnYmEoICR7cn0sICR7Z30sICR7Yn0sICR7cGFydGljbGUub3BhY2l0eX0gKWA7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbGV0IHsgaCwgcywgbCB9ID0gcGFydGljbGUuY29sb3IuaHNsO1xyXG4gICAgICAgICAgICBjb2xvcl92YWx1ZSA9IGByZ2JhKCAke2h9LCAke3N9LCAke2x9LCAke3BhcnRpY2xlLm9wYWNpdHl9IClgO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gY29sb3JfdmFsdWU7XHJcbiAgICB9KTtcclxuXHJcbiAgICBsZXQgc3ZnOiBCbG9iID0gbmV3IEJsb2IoW2NvbG9yZWRTdmdYbWxdLCB7XHJcbiAgICAgICAgdHlwZTogJ2ltYWdlL3N2Zyt4bWw7Y2hhcnNldD11dGYtOCdcclxuICAgIH0pO1xyXG5cclxuICAgIGxldCBET01VUkw6IGFueSA9IHdpbmRvdy5VUkwgfHwgd2luZG93O1xyXG4gICAgbGV0IHVybDogYW55ID0gRE9NVVJMLmNyZWF0ZU9iamVjdFVSTChzdmcpO1xyXG5cclxuICAgIGxldCBpbWcgPSBuZXcgSW1hZ2UoKTtcclxuICAgIGltZy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgKCkgPT4ge1xyXG4gICAgICAgIHBhcnRpY2xlLmltZy5vYmogPSBpbWc7XHJcbiAgICAgICAgcGFydGljbGUuaW1nLmxvYWRlZCA9IHRydWU7XHJcbiAgICAgICAgRE9NVVJMLnJldm9rZU9iamVjdFVSTCh1cmwpO1xyXG4gICAgICAgIHRtcC5jb3VudF9zdmcrKztcclxuICAgIH0pO1xyXG4gICAgaW1nLnNyYyA9IHVybDtcclxufSJdfQ==