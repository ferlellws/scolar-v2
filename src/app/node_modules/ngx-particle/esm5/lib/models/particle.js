import { getColor, createSvgImg } from './utils';
var Particle = /** @class */ (function () {
    function Particle(_canvasParams, _params, _tmpParams, color, opacity, position) {
        this._canvasParams = _canvasParams;
        this._params = _params;
        this._tmpParams = _tmpParams;
        this._setupSize();
        this._setupPosition(position);
        this._setupColor(color);
        this._setupOpacity();
        this._setupAnimation();
    }
    Particle.prototype._setupSize = function () {
        this.radius = (this._params.particles.size.random ? Math.random() : 1) * this._params.particles.size.value;
        if (this._params.particles.size.anim.enable) {
            this.size_status = false;
            this.vs = this._params.particles.size.anim.speed / 100;
            if (!this._params.particles.size.anim.sync)
                this.vs = this.vs * Math.random();
        }
    };
    Particle.prototype._setupPosition = function (position) {
        this.x = position ? position.x : Math.random() * this._canvasParams.width;
        this.y = position ? position.y : Math.random() * this._canvasParams.height;
        if (this.x > this._canvasParams.width - this.radius * 2) {
            this.x = this.x - this.radius;
        }
        else if (this.x < this.radius * 2) {
            this.x = this.x + this.radius;
        }
        if (this.y > this._canvasParams.height - this.radius * 2) {
            this.y = this.y - this.radius;
        }
        else if (this.y < this.radius * 2) {
            this.y = this.y + this.radius;
        }
        if (this._params.particles.move.bounce) {
            this._checkOverlap(this, position);
        }
    };
    Particle.prototype._checkOverlap = function (p1, position) {
        var _this = this;
        var particles = this._params.particles;
        particles.array.forEach(function (particle) {
            var p2 = particle;
            var dx = p1.x - p2.x;
            var dy = p1.y - p2.y;
            var dist = Math.sqrt(dx * dx + dy * dy);
            if (dist <= p1.radius + p2.radius) {
                p1.x = position ? position.x : Math.random() * _this._canvasParams.width;
                p1.y = position ? position.y : Math.random() * _this._canvasParams.height;
                _this._checkOverlap(p1);
            }
        });
    };
    Particle.prototype._setupColor = function (color) {
        this.color = getColor(color.value);
    };
    Particle.prototype._setupOpacity = function () {
        this.opacity = (this._params.particles.opacity.random ? Math.random() : 1) * this._params.particles.opacity.value;
        if (this._params.particles.opacity.anim.enable) {
            this.opacity_status = false;
            this.vo = this._params.particles.opacity.anim.speed / 100;
            if (!this._params.particles.opacity.anim.sync) {
                this.vo = this.vo * Math.random();
            }
        }
    };
    Particle.prototype._setupAnimation = function () {
        var velbase = null;
        switch (this._params.particles.move.direction) {
            case 'top':
                velbase = { x: 0, y: -1 };
                break;
            case 'top-right':
                velbase = { x: 0.5, y: -0.5 };
                break;
            case 'right':
                velbase = { x: 1, y: 0 };
                break;
            case 'bottom-right':
                velbase = { x: 0.5, y: 0.5 };
                break;
            case 'bottom':
                velbase = { x: 0, y: 1 };
                break;
            case 'bottom-left':
                velbase = { x: -0.5, y: 1 };
                break;
            case 'left':
                velbase = { x: -1, y: 0 };
                break;
            case 'top-left':
                velbase = { x: -0.5, y: -0.5 };
                break;
            default:
                velbase = { x: 0, y: 0 };
                break;
        }
        if (this._params.particles.move.straight) {
            this.vx = velbase.x;
            this.vy = velbase.y;
            if (this._params.particles.move.random) {
                this.vx = this.vx * (Math.random());
                this.vy = this.vy * (Math.random());
            }
        }
        else {
            this.vx = velbase.x + Math.random() - 0.5;
            this.vy = velbase.y + Math.random() - 0.5;
        }
        this.vx_i = this.vx;
        this.vy_i = this.vy;
        var shape_type = this._params.particles.shape.type;
        if (typeof (shape_type) == 'object') {
            if (shape_type instanceof Array) {
                var shape_selected = shape_type[Math.floor(Math.random() * shape_type.length)];
                this.shape = shape_selected;
            }
        }
        else {
            this.shape = shape_type;
        }
        if (this.shape == 'image') {
            var sh = this._params.particles.shape;
            this.img = {
                src: sh.image.src,
                ratio: sh.image.width / sh.image.height
            };
            if (!this.img.ratio)
                this.img.ratio = 1;
            if (this._tmpParams.img_type == 'svg' && this._tmpParams.source_svg != undefined) {
                createSvgImg(this, this._tmpParams);
                if (this._tmpParams.pushing) {
                    this.img.loaded = false;
                }
            }
        }
    };
    Particle.prototype._drawShape = function (c, startX, startY, sideLength, sideCountNumerator, sideCountDenominator) {
        var sideCount = sideCountNumerator * sideCountDenominator;
        var decimalSides = sideCountNumerator / sideCountDenominator;
        var interiorAngleDegrees = (180 * (decimalSides - 2)) / decimalSides;
        var interiorAngle = Math.PI - Math.PI * interiorAngleDegrees / 180;
        c.save();
        c.beginPath();
        c.translate(startX, startY);
        c.moveTo(0, 0);
        for (var i = 0; i < sideCount; i++) {
            c.lineTo(sideLength, 0);
            c.translate(sideLength, 0);
            c.rotate(interiorAngle);
        }
        c.fill();
        c.restore();
    };
    Particle.prototype.draw = function () {
        var _this = this;
        var particles = this._params.particles;
        var radius;
        if (this.radius_bubble != undefined) {
            radius = this.radius_bubble;
        }
        else {
            radius = this.radius;
        }
        var opacity;
        if (this.opacity_bubble != undefined) {
            opacity = this.opacity_bubble;
        }
        else {
            opacity = this.opacity;
        }
        var color_value;
        if (this.color.rgb) {
            var _a = this.color.rgb, r = _a.r, g = _a.g, b = _a.b;
            color_value = "rgba( " + r + ", " + g + ", " + b + ", " + opacity + " )";
        }
        else {
            var _b = this.color.hsl, h = _b.h, s = _b.s, l = _b.l;
            color_value = "hsla( " + h + ", " + s + ", " + l + ", " + opacity + " )";
        }
        this._canvasParams.ctx.fillStyle = color_value;
        this._canvasParams.ctx.beginPath();
        switch (this.shape) {
            case 'circle':
                this._canvasParams.ctx.arc(this.x, this.y, radius, 0, Math.PI * 2, false);
                break;
            case 'edge':
                this._canvasParams.ctx.rect(this.x - radius, this.y - radius, radius * 2, radius * 2);
                break;
            case 'triangle':
                this._drawShape(this._canvasParams.ctx, this.x - radius, this.y + radius / 1.66, radius * 2, 3, 2);
                break;
            case 'polygon':
                this._drawShape(this._canvasParams.ctx, this.x - radius / (this._params.particles.shape.polygon.nb_sides / 3.5), this.y - radius / (2.66 / 3.5), radius * 2.66 / (this._params.particles.shape.polygon.nb_sides / 3), this._params.particles.shape.polygon.nb_sides, 1);
                break;
            case 'star':
                this._drawShape(this._canvasParams.ctx, this.x - radius * 2 / (this._params.particles.shape.polygon.nb_sides / 4), this.y - radius / (2 * 2.66 / 3.5), radius * 2 * 2.66 / (this._params.particles.shape.polygon.nb_sides / 3), this._params.particles.shape.polygon.nb_sides, 2);
                break;
            case 'image':
                var draw = function (img_obj) {
                    _this._canvasParams.ctx.drawImage(img_obj, _this.x - radius, _this.y - radius, radius * 2, radius * 2 / _this.img.ratio);
                };
                var img_obj = void 0;
                if (this._tmpParams.img_type == 'svg') {
                    img_obj = this.img.obj;
                }
                else {
                    img_obj = this._tmpParams.img_obj;
                }
                if (img_obj)
                    draw(img_obj);
                break;
        }
        this._canvasParams.ctx.closePath();
        if (this._params.particles.shape.stroke.width > 0) {
            this._canvasParams.ctx.strokeStyle = this._params.particles.shape.stroke.color;
            this._canvasParams.ctx.lineWidth = this._params.particles.shape.stroke.width;
            this._canvasParams.ctx.stroke();
        }
        this._canvasParams.ctx.fill();
    };
    return Particle;
}());
export { Particle };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFydGljbGUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gtcGFydGljbGUvIiwic291cmNlcyI6WyJsaWIvbW9kZWxzL3BhcnRpY2xlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxRQUFRLEVBQUUsWUFBWSxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBRWpEO0lBeUJJLGtCQUFvQixhQUE0QixFQUFVLE9BQWdCLEVBQVUsVUFBc0IsRUFBRSxLQUFXLEVBQUUsT0FBYSxFQUFFLFFBQW9DO1FBQXhKLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBQVUsWUFBTyxHQUFQLE9BQU8sQ0FBUztRQUFVLGVBQVUsR0FBVixVQUFVLENBQVk7UUFDdEcsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQ2xCLElBQUksQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDOUIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN4QixJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDckIsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO0lBQzNCLENBQUM7SUFFTyw2QkFBVSxHQUFsQjtRQUNJLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUM7UUFDM0csSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUN6QyxJQUFJLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQztZQUN6QixJQUFJLENBQUMsRUFBRSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJ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QUMvRSxJQUFJLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7WUFDN0UsSUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLENBQUM7U0FDbkM7UUFFRCxJQUFJLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNsQyxDQUFDO0lBQ0wsZUFBQztBQUFELENBQUMsQUFwU0QsSUFvU0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJQ2FudmFzUGFyYW1zLCBJUGFyYW1zLCBJVG1wUGFyYW1zIH0gZnJvbSAnLi9pbnRlcmZhY2VzJztcclxuaW1wb3J0IHsgZ2V0Q29sb3IsIGNyZWF0ZVN2Z0ltZyB9IGZyb20gJy4vdXRpbHMnO1xyXG5cclxuZXhwb3J0IGNsYXNzIFBhcnRpY2xlIHtcclxuICAgIHJhZGl1czogbnVtYmVyO1xyXG4gICAgcmFkaXVzX2J1YmJsZTogbnVtYmVyO1xyXG4gICAgc2l6ZV9zdGF0dXM6IGJvb2xlYW47XHJcbiAgICB2czogbnVtYmVyO1xyXG5cclxuICAgIHg6IG51bWJlcjtcclxuICAgIHk6IG51bWJlcjtcclxuICAgIGNvbG9yOiBhbnk7XHJcblxyXG4gICAgb3BhY2l0eTogbnVtYmVyO1xyXG4gICAgb3BhY2l0eV9idWJibGU6IG51bWJlcjtcclxuICAgIG9wYWNpdHlfc3RhdHVzOiBib29sZWFuO1xyXG4gICAgdm86IG51bWJlcjtcclxuXHJcbiAgICB2eDogbnVtYmVyO1xyXG4gICAgdnk6IG51bWJlcjtcclxuXHJcbiAgICB2eF9pOiBudW1iZXI7XHJcbiAgICB2eV9pOiBudW1iZXI7XHJcblxyXG4gICAgc2hhcGU6IHN0cmluZztcclxuXHJcbiAgICBpbWc6IHsgc3JjOiBzdHJpbmc7IHJhdGlvOiBudW1iZXI7IGxvYWRlZD86IGJvb2xlYW47IG9iaj86IGFueTsgfTtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIF9jYW52YXNQYXJhbXM6IElDYW52YXNQYXJhbXMsIHByaXZhdGUgX3BhcmFtczogSVBhcmFtcywgcHJpdmF0ZSBfdG1wUGFyYW1zOiBJVG1wUGFyYW1zLCBjb2xvcj86IGFueSwgb3BhY2l0eT86IGFueSwgcG9zaXRpb24/OiB7IHg6IG51bWJlcjsgeTogbnVtYmVyOyB9KSB7XHJcbiAgICAgICAgdGhpcy5fc2V0dXBTaXplKCk7XHJcbiAgICAgICAgdGhpcy5fc2V0dXBQb3NpdGlvbihwb3NpdGlvbik7XHJcbiAgICAgICAgdGhpcy5fc2V0dXBDb2xvcihjb2xvcik7XHJcbiAgICAgICAgdGhpcy5fc2V0dXBPcGFjaXR5KCk7XHJcbiAgICAgICAgdGhpcy5fc2V0dXBBbmltYXRpb24oKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF9zZXR1cFNpemUoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5yYWRpdXMgPSAodGhpcy5fcGFyYW1zLnBhcnRpY2xlcy5zaXplLnJhbmRvbSA/IE1hdGgucmFuZG9tKCkgOiAxKSAqIHRoaXMuX3BhcmFtcy5wYXJ0aWNsZXMuc2l6ZS52YWx1ZTtcclxuICAgICAgICBpZiAodGhpcy5fcGFyYW1zLnBhcnRpY2xlcy5zaXplLmFuaW0uZW5hYmxlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2l6ZV9zdGF0dXMgPSBmYWxzZTtcclxuICAgICAgICAgICAgdGhpcy52cyA9IHRoaXMuX3BhcmFtcy5wYXJ0aWNsZXMuc2l6ZS5hbmltLnNwZWVkIC8gMTAwO1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuX3BhcmFtcy5wYXJ0aWNsZXMuc2l6ZS5hbmltLnN5bmMpXHJcbiAgICAgICAgICAgICAgICB0aGlzLnZzID0gdGhpcy52cyAqIE1hdGgucmFuZG9tKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX3NldHVwUG9zaXRpb24ocG9zaXRpb24/OiB7IHg6IG51bWJlcjsgeTogbnVtYmVyOyB9KTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy54ID0gcG9zaXRpb24gPyBwb3NpdGlvbi54IDogTWF0aC5yYW5kb20oKSAqIHRoaXMuX2NhbnZhc1BhcmFtcy53aWR0aDtcclxuICAgICAgICB0aGlzLnkgPSBwb3NpdGlvbiA/IHBvc2l0aW9uLnkgOiBNYXRoLnJhbmRvbSgpICogdGhpcy5fY2FudmFzUGFyYW1zLmhlaWdodDtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMueCA+IHRoaXMuX2NhbnZhc1BhcmFtcy53aWR0aCAtIHRoaXMucmFkaXVzICogMikge1xyXG4gICAgICAgICAgICB0aGlzLnggPSB0aGlzLnggLSB0aGlzLnJhZGl1cztcclxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMueCA8IHRoaXMucmFkaXVzICogMikge1xyXG4gICAgICAgICAgICB0aGlzLnggPSB0aGlzLnggKyB0aGlzLnJhZGl1cztcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMueSA+IHRoaXMuX2NhbnZhc1BhcmFtcy5oZWlnaHQgLSB0aGlzLnJhZGl1cyAqIDIpIHtcclxuICAgICAgICAgICAgdGhpcy55ID0gdGhpcy55IC0gdGhpcy5yYWRpdXM7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnkgPCB0aGlzLnJhZGl1cyAqIDIpIHtcclxuICAgICAgICAgICAgdGhpcy55ID0gdGhpcy55ICsgdGhpcy5yYWRpdXM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5fcGFyYW1zLnBhcnRpY2xlcy5tb3ZlLmJvdW5jZSkge1xyXG4gICAgICAgICAgICB0aGlzLl9jaGVja092ZXJsYXAodGhpcywgcG9zaXRpb24pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF9jaGVja092ZXJsYXAocDE6IFBhcnRpY2xlLCBwb3NpdGlvbj86IHsgeDogbnVtYmVyOyB5OiBudW1iZXI7IH0pOiB2b2lkIHtcclxuICAgICAgICBsZXQgeyBwYXJ0aWNsZXMgfSA9IHRoaXMuX3BhcmFtcztcclxuXHJcbiAgICAgICAgcGFydGljbGVzLmFycmF5LmZvckVhY2goKHBhcnRpY2xlOiBQYXJ0aWNsZSkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgcDI6IFBhcnRpY2xlID0gcGFydGljbGU7XHJcblxyXG4gICAgICAgICAgICBsZXQgZHg6IG51bWJlciA9IHAxLnggLSBwMi54O1xyXG4gICAgICAgICAgICBsZXQgZHk6IG51bWJlciA9IHAxLnkgLSBwMi55O1xyXG4gICAgICAgICAgICBsZXQgZGlzdDogbnVtYmVyID0gTWF0aC5zcXJ0KGR4ICogZHggKyBkeSAqIGR5KTtcclxuXHJcbiAgICAgICAgICAgIGlmIChkaXN0IDw9IHAxLnJhZGl1cyArIHAyLnJhZGl1cykge1xyXG4gICAgICAgICAgICAgICAgcDEueCA9IHBvc2l0aW9uID8gcG9zaXRpb24ueCA6IE1hdGgucmFuZG9tKCkgKiB0aGlzLl9jYW52YXNQYXJhbXMud2lkdGg7XHJcbiAgICAgICAgICAgICAgICBwMS55ID0gcG9zaXRpb24gPyBwb3NpdGlvbi55IDogTWF0aC5yYW5kb20oKSAqIHRoaXMuX2NhbnZhc1BhcmFtcy5oZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jaGVja092ZXJsYXAocDEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfc2V0dXBDb2xvcihjb2xvcj86IGFueSkge1xyXG4gICAgICAgIHRoaXMuY29sb3IgPSBnZXRDb2xvcihjb2xvci52YWx1ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfc2V0dXBPcGFjaXR5KCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMub3BhY2l0eSA9ICh0aGlzLl9wYXJhbXMucGFydGljbGVzLm9wYWNpdHkucmFuZG9tID8gTWF0aC5yYW5kb20oKSA6IDEpICogdGhpcy5fcGFyYW1zLnBhcnRpY2xlcy5vcGFjaXR5LnZhbHVlO1xyXG4gICAgICAgIGlmICh0aGlzLl9wYXJhbXMucGFydGljbGVzLm9wYWNpdHkuYW5pbS5lbmFibGUpIHtcclxuICAgICAgICAgICAgdGhpcy5vcGFjaXR5X3N0YXR1cyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLnZvID0gdGhpcy5fcGFyYW1zLnBhcnRpY2xlcy5vcGFjaXR5LmFuaW0uc3BlZWQgLyAxMDA7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5fcGFyYW1zLnBhcnRpY2xlcy5vcGFjaXR5LmFuaW0uc3luYykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy52byA9IHRoaXMudm8gKiBNYXRoLnJhbmRvbSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX3NldHVwQW5pbWF0aW9uKCk6IHZvaWQge1xyXG4gICAgICAgIGxldCB2ZWxiYXNlOiB7IHg6IG51bWJlcjsgeTogbnVtYmVyOyB9ID0gbnVsbDtcclxuICAgICAgICBzd2l0Y2ggKHRoaXMuX3BhcmFtcy5wYXJ0aWNsZXMubW92ZS5kaXJlY3Rpb24pIHtcclxuICAgICAgICAgICAgY2FzZSAndG9wJzpcclxuICAgICAgICAgICAgICAgIHZlbGJhc2UgPSB7IHg6IDAsIHk6IC0xIH07XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAndG9wLXJpZ2h0JzpcclxuICAgICAgICAgICAgICAgIHZlbGJhc2UgPSB7IHg6IDAuNSwgeTogLTAuNSB9O1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ3JpZ2h0JzpcclxuICAgICAgICAgICAgICAgIHZlbGJhc2UgPSB7IHg6IDEsIHk6IDAgfTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdib3R0b20tcmlnaHQnOlxyXG4gICAgICAgICAgICAgICAgdmVsYmFzZSA9IHsgwqB4OiAwLjUsIHk6IDAuNSB9O1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2JvdHRvbSc6XHJcbiAgICAgICAgICAgICAgICB2ZWxiYXNlID0geyB4OiAwLCB5OiAxIH07XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnYm90dG9tLWxlZnQnOlxyXG4gICAgICAgICAgICAgICAgdmVsYmFzZSA9IHsgeDogLTAuNSwgeTogMSB9O1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2xlZnQnOlxyXG4gICAgICAgICAgICAgICAgdmVsYmFzZSA9IHsgeDogLTEsIHk6IDAgfTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICd0b3AtbGVmdCc6XHJcbiAgICAgICAgICAgICAgICB2ZWxiYXNlID0geyDCoHg6IC0wLjUsIHk6IC0wLjUgfTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgdmVsYmFzZSA9IHsgwqB4OiAwLCB5OiAwIH07XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0aGlzLl9wYXJhbXMucGFydGljbGVzLm1vdmUuc3RyYWlnaHQpIHtcclxuICAgICAgICAgICAgdGhpcy52eCA9IHZlbGJhc2UueDtcclxuICAgICAgICAgICAgdGhpcy52eSA9IHZlbGJhc2UueTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuX3BhcmFtcy5wYXJ0aWNsZXMubW92ZS5yYW5kb20pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudnggPSB0aGlzLnZ4ICogKE1hdGgucmFuZG9tKCkpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy52eSA9IHRoaXMudnkgKiAoTWF0aC5yYW5kb20oKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLnZ4ID0gdmVsYmFzZS54ICsgTWF0aC5yYW5kb20oKSAtIDAuNTtcclxuICAgICAgICAgICAgdGhpcy52eSA9IHZlbGJhc2UueSArIE1hdGgucmFuZG9tKCkgLSAwLjU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnZ4X2kgPSB0aGlzLnZ4O1xyXG4gICAgICAgIHRoaXMudnlfaSA9IHRoaXMudnk7XHJcblxyXG4gICAgICAgIGxldCBzaGFwZV90eXBlOiBhbnkgPSB0aGlzLl9wYXJhbXMucGFydGljbGVzLnNoYXBlLnR5cGU7XHJcblxyXG4gICAgICAgIGlmICh0eXBlb2YgKHNoYXBlX3R5cGUpID09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgICAgIGlmIChzaGFwZV90eXBlIGluc3RhbmNlb2YgQXJyYXkpIHtcclxuICAgICAgICAgICAgICAgIGxldCBzaGFwZV9zZWxlY3RlZDogc3RyaW5nID0gc2hhcGVfdHlwZVtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBzaGFwZV90eXBlLmxlbmd0aCldO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zaGFwZSA9IHNoYXBlX3NlbGVjdGVkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5zaGFwZSA9IHNoYXBlX3R5cGU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodGhpcy5zaGFwZSA9PSAnaW1hZ2UnKSB7XHJcbiAgICAgICAgICAgIGxldCBzaDogYW55ID0gdGhpcy5fcGFyYW1zLnBhcnRpY2xlcy5zaGFwZTtcclxuICAgICAgICAgICAgdGhpcy5pbWcgPSB7XHJcbiAgICAgICAgICAgICAgICBzcmM6IHNoLmltYWdlLnNyYyxcclxuICAgICAgICAgICAgICAgIHJhdGlvOiBzaC5pbWFnZS53aWR0aCAvIHNoLmltYWdlLmhlaWdodFxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgaWYgKCF0aGlzLmltZy5yYXRpbylcclxuICAgICAgICAgICAgICAgIHRoaXMuaW1nLnJhdGlvID0gMTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuX3RtcFBhcmFtcy5pbWdfdHlwZSA9PSAnc3ZnJyAmJiB0aGlzLl90bXBQYXJhbXMuc291cmNlX3N2ZyAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIGNyZWF0ZVN2Z0ltZyh0aGlzLCB0aGlzLl90bXBQYXJhbXMpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX3RtcFBhcmFtcy5wdXNoaW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbWcubG9hZGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfZHJhd1NoYXBlKGM6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCwgc3RhcnRYOiBudW1iZXIsIHN0YXJ0WTogbnVtYmVyLCBzaWRlTGVuZ3RoOiBudW1iZXIsIHNpZGVDb3VudE51bWVyYXRvcjogbnVtYmVyLCBzaWRlQ291bnREZW5vbWluYXRvcjogbnVtYmVyKTogdm9pZCB7XHJcbiAgICAgICAgbGV0IHNpZGVDb3VudDogbnVtYmVyID0gc2lkZUNvdW50TnVtZXJhdG9yICogc2lkZUNvdW50RGVub21pbmF0b3I7XHJcbiAgICAgICAgbGV0IGRlY2ltYWxTaWRlczogbnVtYmVyID0gc2lkZUNvdW50TnVtZXJhdG9yIC8gc2lkZUNvdW50RGVub21pbmF0b3I7XHJcbiAgICAgICAgbGV0IGludGVyaW9yQW5nbGVEZWdyZWVzOiBudW1iZXIgPSAoMTgwICogKGRlY2ltYWxTaWRlcyAtIDIpKSAvIGRlY2ltYWxTaWRlcztcclxuICAgICAgICBsZXQgaW50ZXJpb3JBbmdsZTogbnVtYmVyID0gTWF0aC5QSSAtIE1hdGguUEkgKiBpbnRlcmlvckFuZ2xlRGVncmVlcyAvIDE4MDtcclxuXHJcbiAgICAgICAgYy5zYXZlKCk7XHJcbiAgICAgICAgYy5iZWdpblBhdGgoKTtcclxuICAgICAgICBjLnRyYW5zbGF0ZShzdGFydFgsIHN0YXJ0WSk7XHJcbiAgICAgICAgYy5tb3ZlVG8oMCwgMCk7XHJcblxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2lkZUNvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgYy5saW5lVG8oc2lkZUxlbmd0aCwgMCk7XHJcbiAgICAgICAgICAgIGMudHJhbnNsYXRlKHNpZGVMZW5ndGgsIDApO1xyXG4gICAgICAgICAgICBjLnJvdGF0ZShpbnRlcmlvckFuZ2xlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGMuZmlsbCgpO1xyXG4gICAgICAgIGMucmVzdG9yZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBkcmF3KCk6IHZvaWQge1xyXG4gICAgICAgIGxldCB7IHBhcnRpY2xlcyB9ID0gdGhpcy5fcGFyYW1zO1xyXG5cclxuICAgICAgICBsZXQgcmFkaXVzOiBudW1iZXI7XHJcbiAgICAgICAgaWYgKHRoaXMucmFkaXVzX2J1YmJsZSAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgcmFkaXVzID0gdGhpcy5yYWRpdXNfYnViYmxlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJhZGl1cyA9IHRoaXMucmFkaXVzO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IG9wYWNpdHk6IG51bWJlcjtcclxuICAgICAgICBpZiAodGhpcy5vcGFjaXR5X2J1YmJsZSAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgb3BhY2l0eSA9IHRoaXMub3BhY2l0eV9idWJibGU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgb3BhY2l0eSA9IHRoaXMub3BhY2l0eTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBjb2xvcl92YWx1ZTogc3RyaW5nO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5jb2xvci5yZ2IpIHtcclxuICAgICAgICAgICAgbGV0IHsgciwgZywgYiB9ID0gdGhpcy5jb2xvci5yZ2I7XHJcbiAgICAgICAgICAgIGNvbG9yX3ZhbHVlID0gYHJnYmEoICR7cn0sICR7Z30sICR7Yn0sICR7b3BhY2l0eX0gKWA7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbGV0IHsgaCwgcywgbCB9ID0gdGhpcy5jb2xvci5oc2w7XHJcbiAgICAgICAgICAgIGNvbG9yX3ZhbHVlID0gYGhzbGEoICR7aH0sICR7c30sICR7bH0sICR7b3BhY2l0eX0gKWA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLl9jYW52YXNQYXJhbXMuY3R4LmZpbGxTdHlsZSA9IGNvbG9yX3ZhbHVlO1xyXG4gICAgICAgIHRoaXMuX2NhbnZhc1BhcmFtcy5jdHguYmVnaW5QYXRoKCk7XHJcblxyXG4gICAgICAgIHN3aXRjaCAodGhpcy5zaGFwZSkge1xyXG4gICAgICAgICAgICBjYXNlICdjaXJjbGUnOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5fY2FudmFzUGFyYW1zLmN0eC5hcmModGhpcy54LCB0aGlzLnksIHJhZGl1cywgMCwgTWF0aC5QSSAqIDIsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSAnZWRnZSc6XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jYW52YXNQYXJhbXMuY3R4LnJlY3QodGhpcy54IC0gcmFkaXVzLCB0aGlzLnkgLSByYWRpdXMsIHJhZGl1cyAqIDIsIHJhZGl1cyAqIDIpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgICAgICBjYXNlICd0cmlhbmdsZSc6XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9kcmF3U2hhcGUodGhpcy5fY2FudmFzUGFyYW1zLmN0eCwgdGhpcy54IC0gcmFkaXVzLCB0aGlzLnkgKyByYWRpdXMgLyAxLjY2LCByYWRpdXMgKiAyLCAzLCAyKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSAncG9seWdvbic6XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9kcmF3U2hhcGUoXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2FudmFzUGFyYW1zLmN0eCxcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnggLSByYWRpdXMgLyAodGhpcy5fcGFyYW1zLnBhcnRpY2xlcy5zaGFwZS5wb2x5Z29uLm5iX3NpZGVzIC8gMy41KSxcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnkgLSByYWRpdXMgLyAoMi42NiAvIDMuNSksXHJcbiAgICAgICAgICAgICAgICAgICAgcmFkaXVzICogMi42NiAvICh0aGlzLl9wYXJhbXMucGFydGljbGVzLnNoYXBlLnBvbHlnb24ubmJfc2lkZXMgLyAzKSxcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9wYXJhbXMucGFydGljbGVzLnNoYXBlLnBvbHlnb24ubmJfc2lkZXMsXHJcbiAgICAgICAgICAgICAgICAgICAgMVxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgICAgY2FzZSAnc3Rhcic6XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9kcmF3U2hhcGUoXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2FudmFzUGFyYW1zLmN0eCxcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnggLSByYWRpdXMgKiAyIC8gKHRoaXMuX3BhcmFtcy5wYXJ0aWNsZXMuc2hhcGUucG9seWdvbi5uYl9zaWRlcyAvIDQpLFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMueSAtIHJhZGl1cyAvICgyICogMi42NiAvIDMuNSksXHJcbiAgICAgICAgICAgICAgICAgICAgcmFkaXVzICogMiAqIDIuNjYgLyAodGhpcy5fcGFyYW1zLnBhcnRpY2xlcy5zaGFwZS5wb2x5Z29uLm5iX3NpZGVzIC8gMyksXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGFyYW1zLnBhcnRpY2xlcy5zaGFwZS5wb2x5Z29uLm5iX3NpZGVzLFxyXG4gICAgICAgICAgICAgICAgICAgIDJcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgICAgIGNhc2UgJ2ltYWdlJzpcclxuICAgICAgICAgICAgICAgIGxldCBkcmF3OiAoaW1nX29iajogYW55KSA9PiB2b2lkID1cclxuICAgICAgICAgICAgICAgICAgICAoaW1nX29iaikgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9jYW52YXNQYXJhbXMuY3R4LmRyYXdJbWFnZShcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltZ19vYmosXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnggLSByYWRpdXMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnkgLSByYWRpdXMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByYWRpdXMgKiAyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFkaXVzICogMiAvIHRoaXMuaW1nLnJhdGlvXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIGxldCBpbWdfb2JqOiBhbnk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX3RtcFBhcmFtcy5pbWdfdHlwZSA9PSAnc3ZnJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGltZ19vYmogPSB0aGlzLmltZy5vYmo7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGltZ19vYmogPSB0aGlzLl90bXBQYXJhbXMuaW1nX29iajtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoaW1nX29iailcclxuICAgICAgICAgICAgICAgICAgICBkcmF3KGltZ19vYmopO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLl9jYW52YXNQYXJhbXMuY3R4LmNsb3NlUGF0aCgpO1xyXG5cclxuICAgICAgICBpZiAodGhpcy5fcGFyYW1zLnBhcnRpY2xlcy5zaGFwZS5zdHJva2Uud2lkdGggPiAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2NhbnZhc1BhcmFtcy5jdHguc3Ryb2tlU3R5bGUgPSB0aGlzLl9wYXJhbXMucGFydGljbGVzLnNoYXBlLnN0cm9rZS5jb2xvcjtcclxuICAgICAgICAgICAgdGhpcy5fY2FudmFzUGFyYW1zLmN0eC5saW5lV2lkdGggPSB0aGlzLl9wYXJhbXMucGFydGljbGVzLnNoYXBlLnN0cm9rZS53aWR0aDtcclxuICAgICAgICAgICAgdGhpcy5fY2FudmFzUGFyYW1zLmN0eC5zdHJva2UoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuX2NhbnZhc1BhcmFtcy5jdHguZmlsbCgpO1xyXG4gICAgfVxyXG59Il19