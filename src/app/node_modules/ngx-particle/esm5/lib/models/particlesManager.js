import { ParticleInteraction } from './particleInteraction';
import { Particle } from './particle';
import { isInArray, clamp } from './utils';
var ParticlesManager = /** @class */ (function () {
    function ParticlesManager(_canvasParams, _params, _tmpParams) {
        this._canvasParams = _canvasParams;
        this._params = _params;
        this._tmpParams = _tmpParams;
        this._interaction = new ParticleInteraction();
    }
    ParticlesManager.prototype.particlesCreate = function () {
        var _a = this._params.particles, color = _a.color, opacity = _a.opacity;
        for (var i = 0; i < this._params.particles.number.value; i++) {
            this._params.particles.array.push(new Particle(this._canvasParams, this._params, this._tmpParams, color, opacity.value));
        }
    };
    ParticlesManager.prototype._particlesUpdate = function () {
        var _this = this;
        this._params.particles.array.forEach(function (particle, i) {
            if (_this._params.particles.move.enable) {
                var ms = _this._params.particles.move.speed / 2;
                particle.x += particle.vx * ms;
                particle.y += particle.vy * ms;
            }
            if (_this._params.particles.opacity.anim.enable) {
                if (particle.opacity_status == true) {
                    if (particle.opacity >= _this._params.particles.opacity.value)
                        particle.opacity_status = false;
                    particle.opacity += particle.vo;
                }
                else {
                    if (particle.opacity <= _this._params.particles.opacity.anim.opacity_min)
                        particle.opacity_status = true;
                    particle.opacity -= particle.vo;
                }
                if (particle.opacity < 0)
                    particle.opacity = 0;
            }
            if (_this._params.particles.size.anim.enable) {
                if (particle.size_status == true) {
                    if (particle.radius >= _this._params.particles.size.value)
                        particle.size_status = false;
                    particle.radius += particle.vs;
                }
                else {
                    if (particle.radius <= _this._params.particles.size.anim.size_min)
                        particle.size_status = true;
                    particle.radius -= particle.vs;
                }
                if (particle.radius < 0)
                    particle.radius = 0;
            }
            var new_pos;
            if (_this._params.particles.move.out_mode == 'bounce') {
                new_pos = {
                    x_left: particle.radius,
                    x_right: _this._canvasParams.width,
                    y_top: particle.radius,
                    y_bottom: _this._canvasParams.height
                };
            }
            else {
                new_pos = {
                    x_left: -particle.radius,
                    x_right: _this._canvasParams.width + particle.radius,
                    y_top: -particle.radius,
                    y_bottom: _this._canvasParams.height + particle.radius
                };
            }
            if (particle.x - particle.radius > _this._canvasParams.width) {
                particle.x = new_pos.x_left;
                particle.y = Math.random() * _this._canvasParams.height;
            }
            else if (particle.x + particle.radius < 0) {
                particle.x = new_pos.x_right;
                particle.y = Math.random() * _this._canvasParams.height;
            }
            if (particle.y - particle.radius > _this._canvasParams.height) {
                particle.y = new_pos.y_top;
                particle.x = Math.random() * _this._canvasParams.width;
            }
            else if (particle.y + particle.radius < 0) {
                particle.y = new_pos.y_bottom;
                particle.x = Math.random() * _this._canvasParams.width;
            }
            switch (_this._params.particles.move.out_mode) {
                case 'bounce':
                    if (particle.x + particle.radius > _this._canvasParams.width)
                        particle.vx = -particle.vx;
                    else if (particle.x - particle.radius < 0)
                        particle.vx = -particle.vx;
                    if (particle.y + particle.radius > _this._canvasParams.height)
                        particle.vy = -particle.vy;
                    else if (particle.y - particle.radius < 0)
                        particle.vy = -particle.vy;
                    break;
            }
            if (isInArray('grab', _this._params.interactivity.events.onhover.mode)) {
                _this._grabParticle(particle);
            }
            if (isInArray('bubble', _this._params.interactivity.events.onhover.mode) ||
                isInArray('bubble', _this._params.interactivity.events.onclick.mode)) {
                _this._bubbleParticle(particle);
            }
            if (isInArray('repulse', _this._params.interactivity.events.onhover.mode) ||
                isInArray('repulse', _this._params.interactivity.events.onclick.mode)) {
                _this._repulseParticle(particle);
            }
            if (_this._params.particles.line_linked.enable || _this._params.particles.move.attract.enable) {
                for (var j = i + 1; j < _this._params.particles.array.length; j++) {
                    var link = _this._params.particles.array[j];
                    if (_this._params.particles.line_linked.enable)
                        _this._interaction.linkParticles(particle, link, _this._params, _this._canvasParams);
                    if (_this._params.particles.move.attract.enable)
                        _this._interaction.attractParticles(particle, link, _this._params);
                    if (_this._params.particles.move.bounce)
                        _this._interaction.bounceParticles(particle, link);
                }
            }
        });
    };
    ParticlesManager.prototype.particlesDraw = function () {
        this._canvasParams.ctx.clearRect(0, 0, this._canvasParams.width, this._canvasParams.height);
        this._particlesUpdate();
        this._params.particles.array.forEach(function (particle) {
            particle.draw();
        });
    };
    ParticlesManager.prototype.particlesEmpty = function () {
        this._params.particles.array = [];
    };
    ParticlesManager.prototype.removeParticles = function (nb) {
        this._params.particles.array.splice(0, nb);
        if (!this._params.particles.move.enable) {
            this.particlesDraw();
        }
    };
    ParticlesManager.prototype.pushParticles = function (nb, pos) {
        this._tmpParams.pushing = true;
        for (var i = 0; i < nb; i++) {
            this._params.particles.array.push(new Particle(this._canvasParams, this._params, this._tmpParams, this._params.particles.color, this._params.particles.opacity.value, {
                x: pos ? pos.pos_x : Math.random() * this._canvasParams.width,
                y: pos ? pos.pos_y : Math.random() * this._canvasParams.height
            }));
            if (i == nb - 1) {
                if (!this._params.particles.move.enable) {
                    this.particlesDraw();
                }
                this._tmpParams.pushing = false;
            }
        }
    };
    ParticlesManager.prototype._bubbleParticle = function (particle) {
        var _this = this;
        if (this._params.interactivity.events.onhover.enable &&
            isInArray('bubble', this._params.interactivity.events.onhover.mode)) {
            var dx_mouse = particle.x - this._params.interactivity.mouse.pos_x;
            var dy_mouse = particle.y - this._params.interactivity.mouse.pos_y;
            var dist_mouse = Math.sqrt(dx_mouse * dx_mouse + dy_mouse * dy_mouse);
            var ratio = 1 - dist_mouse / this._params.interactivity.modes.bubble.distance;
            var init = function () {
                particle.opacity_bubble = particle.opacity;
                particle.radius_bubble = particle.radius;
            };
            if (dist_mouse <= this._params.interactivity.modes.bubble.distance) {
                if (ratio >= 0 && this._params.interactivity.status == 'mousemove') {
                    if (this._params.interactivity.modes.bubble.size != this._params.particles.size.value) {
                        if (this._params.interactivity.modes.bubble.size > this._params.particles.size.value) {
                            var size = particle.radius + (this._params.interactivity.modes.bubble.size * ratio);
                            if (size >= 0) {
                                particle.radius_bubble = size;
                            }
                        }
                        else {
                            var dif = particle.radius - this._params.interactivity.modes.bubble.size;
                            var size = particle.radius - (dif * ratio);
                            if (size > 0) {
                                particle.radius_bubble = size;
                            }
                            else {
                                particle.radius_bubble = 0;
                            }
                        }
                    }
                    if (this._params.interactivity.modes.bubble.opacity != this._params.particles.opacity.value) {
                        if (this._params.interactivity.modes.bubble.opacity > this._params.particles.opacity.value) {
                            var opacity = this._params.interactivity.modes.bubble.opacity * ratio;
                            if (opacity > particle.opacity && opacity <= this._params.interactivity.modes.bubble.opacity) {
                                particle.opacity_bubble = opacity;
                            }
                        }
                        else {
                            var opacity = particle.opacity - (this._params.particles.opacity.value - this._params.interactivity.modes.bubble.opacity) * ratio;
                            if (opacity < particle.opacity && opacity >= this._params.interactivity.modes.bubble.opacity) {
                                particle.opacity_bubble = opacity;
                            }
                        }
                    }
                }
            }
            else {
                init();
            }
            if (this._params.interactivity.status == 'mouseleave') {
                init();
            }
        }
        else if (this._params.interactivity.events.onclick.enable &&
            isInArray('bubble', this._params.interactivity.events.onclick.mode)) {
            if (this._tmpParams.bubble_clicking) {
                var dx_mouse = particle.x - this._params.interactivity.mouse.click_pos_x;
                var dy_mouse = particle.y - this._params.interactivity.mouse.click_pos_y;
                var dist_mouse_1 = Math.sqrt(dx_mouse * dx_mouse + dy_mouse * dy_mouse);
                var time_spent_1 = (new Date().getTime() - this._params.interactivity.mouse.click_time) / 1000;
                if (time_spent_1 > this._params.interactivity.modes.bubble.duration) {
                    this._tmpParams.bubble_duration_end = true;
                }
                if (time_spent_1 > this._params.interactivity.modes.bubble.duration * 2) {
                    this._tmpParams.bubble_clicking = false;
                    this._tmpParams.bubble_duration_end = false;
                }
                var process = function (bubble_param, particles_param, p_obj_bubble, p_obj, id) {
                    if (bubble_param != particles_param) {
                        if (!_this._tmpParams.bubble_duration_end) {
                            if (dist_mouse_1 <= _this._params.interactivity.modes.bubble.distance) {
                                var obj = void 0;
                                if (p_obj_bubble != undefined) {
                                    obj = p_obj_bubble;
                                }
                                else {
                                    obj = p_obj;
                                }
                                if (obj != bubble_param) {
                                    var value = p_obj - (time_spent_1 * (p_obj - bubble_param) / _this._params.interactivity.modes.bubble.duration);
                                    if (id == 'size')
                                        particle.radius_bubble = value;
                                    if (id == 'opacity')
                                        particle.opacity_bubble = value;
                                }
                            }
                            else {
                                if (id == 'size')
                                    particle.radius_bubble = undefined;
                                if (id == 'opacity')
                                    particle.opacity_bubble = undefined;
                            }
                        }
                        else {
                            if (p_obj_bubble != undefined) {
                                var value_tmp = p_obj - (time_spent_1 * (p_obj - bubble_param) / _this._params.interactivity.modes.bubble.duration);
                                var dif = bubble_param - value_tmp;
                                var value = bubble_param + dif;
                                if (id == 'size')
                                    particle.radius_bubble = value;
                                if (id == 'opacity')
                                    particle.opacity_bubble = value;
                            }
                        }
                    }
                };
                if (this._tmpParams.bubble_clicking) {
                    process(this._params.interactivity.modes.bubble.size, this._params.particles.size.value, particle.radius_bubble, particle.radius, 'size');
                    process(this._params.interactivity.modes.bubble.opacity, this._params.particles.opacity.value, particle.opacity_bubble, particle.opacity, 'opacity');
                }
            }
        }
    };
    ParticlesManager.prototype._repulseParticle = function (particle) {
        var _this = this;
        if (this._params.interactivity.events.onhover.enable &&
            isInArray('repulse', this._params.interactivity.events.onhover.mode) &&
            this._params.interactivity.status == 'mousemove') {
            var dx_mouse = particle.x - this._params.interactivity.mouse.pos_x;
            var dy_mouse = particle.y - this._params.interactivity.mouse.pos_y;
            var dist_mouse = Math.sqrt(dx_mouse * dx_mouse + dy_mouse * dy_mouse);
            var normVec = { x: dx_mouse / dist_mouse, y: dy_mouse / dist_mouse };
            var repulseRadius = this._params.interactivity.modes.repulse.distance;
            var velocity = 100;
            var repulseFactor = clamp((1 / repulseRadius) * (-1 * Math.pow(dist_mouse / repulseRadius, 2) + 1) * repulseRadius * velocity, 0, 50);
            var pos = {
                x: particle.x + normVec.x * repulseFactor,
                y: particle.y + normVec.y * repulseFactor
            };
            if (this._params.particles.move.out_mode == 'bounce') {
                if (pos.x - particle.radius > 0 && pos.x + particle.radius < this._canvasParams.width)
                    particle.x = pos.x;
                if (pos.y - particle.radius > 0 && pos.y + particle.radius < this._canvasParams.height)
                    particle.y = pos.y;
            }
            else {
                particle.x = pos.x;
                particle.y = pos.y;
            }
        }
        else if (this._params.interactivity.events.onclick.enable &&
            isInArray('repulse', this._params.interactivity.events.onclick.mode)) {
            if (!this._tmpParams.repulse_finish) {
                this._tmpParams.repulse_count++;
                if (this._tmpParams.repulse_count == this._params.particles.array.length)
                    this._tmpParams.repulse_finish = true;
            }
            if (this._tmpParams.repulse_clicking) {
                var repulseRadius = Math.pow(this._params.interactivity.modes.repulse.distance / 6, 3);
                var dx_1 = this._params.interactivity.mouse.click_pos_x - particle.x;
                var dy_1 = this._params.interactivity.mouse.click_pos_y - particle.y;
                var d = dx_1 * dx_1 + dy_1 * dy_1;
                var force_1 = -repulseRadius / d * 1;
                var process = function () {
                    var f = Math.atan2(dy_1, dx_1);
                    particle.vx = force_1 * Math.cos(f);
                    particle.vy = force_1 * Math.sin(f);
                    if (_this._params.particles.move.out_mode == 'bounce') {
                        var pos = {
                            x: particle.x + particle.vx,
                            y: particle.y + particle.vy
                        };
                        if (pos.x + particle.radius > _this._canvasParams.width)
                            particle.vx = -particle.vx;
                        else if (pos.x - particle.radius < 0)
                            particle.vx = -particle.vx;
                        if (pos.y + particle.radius > _this._canvasParams.height)
                            particle.vy = -particle.vy;
                        else if (pos.y - particle.radius < 0)
                            particle.vy = -particle.vy;
                    }
                };
                if (d <= repulseRadius) {
                    process();
                }
            }
            else {
                if (this._tmpParams.repulse_clicking == false) {
                    particle.vx = particle.vx_i;
                    particle.vy = particle.vy_i;
                }
            }
        }
    };
    ParticlesManager.prototype._grabParticle = function (particle) {
        var _a = this._params, interactivity = _a.interactivity, particles = _a.particles;
        if (interactivity.events.onhover.enable &&
            interactivity.status == 'mousemove') {
            var dx_mouse = particle.x - interactivity.mouse.pos_x;
            var dy_mouse = particle.y - interactivity.mouse.pos_y;
            var dist_mouse = Math.sqrt(dx_mouse * dx_mouse + dy_mouse * dy_mouse);
            if (dist_mouse <= interactivity.modes.grab.distance) {
                var grab = interactivity.modes.grab;
                var opacity_line = grab.line_linked.opacity - (dist_mouse / (1 / grab.line_linked.opacity)) / grab.distance;
                if (opacity_line > 0) {
                    var color_line = particles.line_linked.color_rgb_line;
                    var r = color_line.r, g = color_line.g, b = color_line.b;
                    this._canvasParams.ctx.strokeStyle = "rgba( " + r + ", " + g + ", " + b + ", " + opacity_line + " )";
                    this._canvasParams.ctx.lineWidth = particles.line_linked.width;
                    this._canvasParams.ctx.beginPath();
                    this._canvasParams.ctx.moveTo(particle.x, particle.y);
                    this._canvasParams.ctx.lineTo(interactivity.mouse.pos_x, interactivity.mouse.pos_y);
                    this._canvasParams.ctx.stroke();
                    this._canvasParams.ctx.closePath();
                }
            }
        }
    };
    return ParticlesManager;
}());
export { ParticlesManager };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFydGljbGVzTWFuYWdlci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1wYXJ0aWNsZS8iLCJzb3VyY2VzIjpbImxpYi9tb2RlbHMvcGFydGljbGVzTWFuYWdlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUU1RCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBQ3RDLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBRTNDO0lBR0ksMEJBQW9CLGFBQTRCLEVBQVUsT0FBZ0IsRUFBVSxVQUFzQjtRQUF0RixrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQUFVLFlBQU8sR0FBUCxPQUFPLENBQVM7UUFBVSxlQUFVLEdBQVYsVUFBVSxDQUFZO1FBQ3RHLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxtQkFBbUIsRUFBRSxDQUFDO0lBQ2xELENBQUM7SUFFTSwwQ0FBZSxHQUF0QjtRQUNRLElBQUEsMkJBQTJDLEVBQXpDLGdCQUFLLEVBQUUsb0JBQWtDLENBQUM7UUFDaEQsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDMUQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLFFBQVEsQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFLElBQUksQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLFVBQVUsRUFBRSxLQUFLLEVBQUUsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7U0FDNUg7SUFDTCxDQUFDO0lBRU8sMkNBQWdCLEdBQXhCO1FBQUEsaUJBdUhDO1FBL0dHLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxP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QUUsQ0FBQztvQkFDaEMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLENBQUM7aUJBQ3RDO2FBQ0o7U0FDSjtJQUNMLENBQUM7SUFDTCx1QkFBQztBQUFELENBQUMsQUF0YUQsSUFzYUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYXJ0aWNsZUludGVyYWN0aW9uIH0gZnJvbSAnLi9wYXJ0aWNsZUludGVyYWN0aW9uJztcclxuaW1wb3J0IHsgSVBhcmFtcywgSUNhbnZhc1BhcmFtcywgSU1vdXNlUGFyYW1zLCBJVG1wUGFyYW1zIH0gZnJvbSAnLi9pbnRlcmZhY2VzJztcclxuaW1wb3J0IHsgUGFydGljbGUgfSBmcm9tICcuL3BhcnRpY2xlJztcclxuaW1wb3J0IHsgaXNJbkFycmF5LCBjbGFtcCB9IGZyb20gJy4vdXRpbHMnO1xyXG5cclxuZXhwb3J0IGNsYXNzIFBhcnRpY2xlc01hbmFnZXIge1xyXG4gICAgcHJpdmF0ZSBfaW50ZXJhY3Rpb246IFBhcnRpY2xlSW50ZXJhY3Rpb247XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBfY2FudmFzUGFyYW1zOiBJQ2FudmFzUGFyYW1zLCBwcml2YXRlIF9wYXJhbXM6IElQYXJhbXMsIHByaXZhdGUgX3RtcFBhcmFtczogSVRtcFBhcmFtcykge1xyXG4gICAgICAgIHRoaXMuX2ludGVyYWN0aW9uID0gbmV3IFBhcnRpY2xlSW50ZXJhY3Rpb24oKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgcGFydGljbGVzQ3JlYXRlKCk6IHZvaWQge1xyXG4gICAgICAgIGxldCB7IGNvbG9yLCBvcGFjaXR5IH0gPSB0aGlzLl9wYXJhbXMucGFydGljbGVzO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5fcGFyYW1zLnBhcnRpY2xlcy5udW1iZXIudmFsdWU7IGkrKykge1xyXG4gICAgICAgICAgICB0aGlzLl9wYXJhbXMucGFydGljbGVzLmFycmF5LnB1c2gobmV3IFBhcnRpY2xlKHRoaXMuX2NhbnZhc1BhcmFtcywgdGhpcy5fcGFyYW1zLCB0aGlzLl90bXBQYXJhbXMsIGNvbG9yLCBvcGFjaXR5LnZhbHVlKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX3BhcnRpY2xlc1VwZGF0ZSgpOiB2b2lkIHtcclxuICAgICAgICB0eXBlIFBvcyA9IHtcclxuICAgICAgICAgICAgeF9sZWZ0OiBudW1iZXI7XHJcbiAgICAgICAgICAgIHhfcmlnaHQ6IG51bWJlcjtcclxuICAgICAgICAgICAgeV90b3A6IG51bWJlcjtcclxuICAgICAgICAgICAgeV9ib3R0b206IG51bWJlcjtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aGlzLl9wYXJhbXMucGFydGljbGVzLmFycmF5LmZvckVhY2goKHBhcnRpY2xlOiBQYXJ0aWNsZSwgaTogbnVtYmVyKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9wYXJhbXMucGFydGljbGVzLm1vdmUuZW5hYmxlKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgbXMgPSB0aGlzLl9wYXJhbXMucGFydGljbGVzLm1vdmUuc3BlZWQgLyAyO1xyXG4gICAgICAgICAgICAgICAgcGFydGljbGUueCArPSBwYXJ0aWNsZS52eCAqIG1zO1xyXG4gICAgICAgICAgICAgICAgcGFydGljbGUueSArPSBwYXJ0aWNsZS52eSAqIG1zO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5fcGFyYW1zLnBhcnRpY2xlcy5vcGFjaXR5LmFuaW0uZW5hYmxlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocGFydGljbGUub3BhY2l0eV9zdGF0dXMgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwYXJ0aWNsZS5vcGFjaXR5ID49IHRoaXMuX3BhcmFtcy5wYXJ0aWNsZXMub3BhY2l0eS52YWx1ZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFydGljbGUub3BhY2l0eV9zdGF0dXMgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBwYXJ0aWNsZS5vcGFjaXR5ICs9IHBhcnRpY2xlLnZvO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocGFydGljbGUub3BhY2l0eSA8PSB0aGlzLl9wYXJhbXMucGFydGljbGVzLm9wYWNpdHkuYW5pbS5vcGFjaXR5X21pbilcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFydGljbGUub3BhY2l0eV9zdGF0dXMgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlLm9wYWNpdHkgLT0gcGFydGljbGUudm87XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAocGFydGljbGUub3BhY2l0eSA8IDApXHJcbiAgICAgICAgICAgICAgICAgICAgcGFydGljbGUub3BhY2l0eSA9IDA7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9wYXJhbXMucGFydGljbGVzLnNpemUuYW5pbS5lbmFibGUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChwYXJ0aWNsZS5zaXplX3N0YXR1cyA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnRpY2xlLnJhZGl1cyA+PSB0aGlzLl9wYXJhbXMucGFydGljbGVzLnNpemUudmFsdWUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlLnNpemVfc3RhdHVzID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgcGFydGljbGUucmFkaXVzICs9IHBhcnRpY2xlLnZzO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocGFydGljbGUucmFkaXVzIDw9IHRoaXMuX3BhcmFtcy5wYXJ0aWNsZXMuc2l6ZS5hbmltLnNpemVfbWluKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJ0aWNsZS5zaXplX3N0YXR1cyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgcGFydGljbGUucmFkaXVzIC09IHBhcnRpY2xlLnZzO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHBhcnRpY2xlLnJhZGl1cyA8IDApXHJcbiAgICAgICAgICAgICAgICAgICAgcGFydGljbGUucmFkaXVzID0gMDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgbGV0IG5ld19wb3M6IFBvcztcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9wYXJhbXMucGFydGljbGVzLm1vdmUub3V0X21vZGUgPT0gJ2JvdW5jZScpIHtcclxuICAgICAgICAgICAgICAgIG5ld19wb3MgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgeF9sZWZ0OiBwYXJ0aWNsZS5yYWRpdXMsXHJcbiAgICAgICAgICAgICAgICAgICAgeF9yaWdodDogdGhpcy5fY2FudmFzUGFyYW1zLndpZHRoLFxyXG4gICAgICAgICAgICAgICAgICAgIHlfdG9wOiBwYXJ0aWNsZS5yYWRpdXMsXHJcbiAgICAgICAgICAgICAgICAgICAgeV9ib3R0b206IHRoaXMuX2NhbnZhc1BhcmFtcy5oZWlnaHRcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBuZXdfcG9zID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHhfbGVmdDogLXBhcnRpY2xlLnJhZGl1cyxcclxuICAgICAgICAgICAgICAgICAgICB4X3JpZ2h0OiB0aGlzLl9jYW52YXNQYXJhbXMud2lkdGggKyBwYXJ0aWNsZS5yYWRpdXMsXHJcbiAgICAgICAgICAgICAgICAgICAgeV90b3A6IC1wYXJ0aWNsZS5yYWRpdXMsXHJcbiAgICAgICAgICAgICAgICAgICAgeV9ib3R0b206IHRoaXMuX2NhbnZhc1BhcmFtcy5oZWlnaHQgKyBwYXJ0aWNsZS5yYWRpdXNcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChwYXJ0aWNsZS54IC0gcGFydGljbGUucmFkaXVzID4gdGhpcy5fY2FudmFzUGFyYW1zLndpZHRoKSB7XHJcbiAgICAgICAgICAgICAgICBwYXJ0aWNsZS54ID0gbmV3X3Bvcy54X2xlZnQ7XHJcbiAgICAgICAgICAgICAgICBwYXJ0aWNsZS55ID0gTWF0aC5yYW5kb20oKSAqIHRoaXMuX2NhbnZhc1BhcmFtcy5oZWlnaHQ7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocGFydGljbGUueCArIHBhcnRpY2xlLnJhZGl1cyA8IDApIHtcclxuICAgICAgICAgICAgICAgIHBhcnRpY2xlLnggPSBuZXdfcG9zLnhfcmlnaHQ7XHJcbiAgICAgICAgICAgICAgICBwYXJ0aWNsZS55ID0gTWF0aC5yYW5kb20oKSAqIHRoaXMuX2NhbnZhc1BhcmFtcy5oZWlnaHQ7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChwYXJ0aWNsZS55IC0gcGFydGljbGUucmFkaXVzID4gdGhpcy5fY2FudmFzUGFyYW1zLmhlaWdodCkge1xyXG4gICAgICAgICAgICAgICAgcGFydGljbGUueSA9IG5ld19wb3MueV90b3A7XHJcbiAgICAgICAgICAgICAgICBwYXJ0aWNsZS54ID0gTWF0aC5yYW5kb20oKSAqIHRoaXMuX2NhbnZhc1BhcmFtcy53aWR0aDtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChwYXJ0aWNsZS55ICsgcGFydGljbGUucmFkaXVzIDwgMCkge1xyXG4gICAgICAgICAgICAgICAgcGFydGljbGUueSA9IG5ld19wb3MueV9ib3R0b207XHJcbiAgICAgICAgICAgICAgICBwYXJ0aWNsZS54ID0gTWF0aC5yYW5kb20oKSAqIHRoaXMuX2NhbnZhc1BhcmFtcy53aWR0aDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgc3dpdGNoICh0aGlzLl9wYXJhbXMucGFydGljbGVzLm1vdmUub3V0X21vZGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2JvdW5jZSc6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnRpY2xlLnggKyBwYXJ0aWNsZS5yYWRpdXMgPiB0aGlzLl9jYW52YXNQYXJhbXMud2lkdGgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlLnZ4ID0gLXBhcnRpY2xlLnZ4O1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBhcnRpY2xlLnggLSBwYXJ0aWNsZS5yYWRpdXMgPCAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJ0aWNsZS52eCA9IC1wYXJ0aWNsZS52eDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocGFydGljbGUueSArIHBhcnRpY2xlLnJhZGl1cyA+IHRoaXMuX2NhbnZhc1BhcmFtcy5oZWlnaHQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlLnZ5ID0gLXBhcnRpY2xlLnZ5O1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBhcnRpY2xlLnkgLSBwYXJ0aWNsZS5yYWRpdXMgPCAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJ0aWNsZS52eSA9IC1wYXJ0aWNsZS52eTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGlzSW5BcnJheSgnZ3JhYicsIHRoaXMuX3BhcmFtcy5pbnRlcmFjdGl2aXR5LmV2ZW50cy5vbmhvdmVyLm1vZGUpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9ncmFiUGFydGljbGUocGFydGljbGUpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoaXNJbkFycmF5KCdidWJibGUnLCB0aGlzLl9wYXJhbXMuaW50ZXJhY3Rpdml0eS5ldmVudHMub25ob3Zlci5tb2RlKSB8fFxyXG4gICAgICAgICAgICAgICAgaXNJbkFycmF5KCdidWJibGUnLCB0aGlzLl9wYXJhbXMuaW50ZXJhY3Rpdml0eS5ldmVudHMub25jbGljay5tb2RlKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fYnViYmxlUGFydGljbGUocGFydGljbGUpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoaXNJbkFycmF5KCdyZXB1bHNlJywgdGhpcy5fcGFyYW1zLmludGVyYWN0aXZpdHkuZXZlbnRzLm9uaG92ZXIubW9kZSkgfHxcclxuICAgICAgICAgICAgICAgIGlzSW5BcnJheSgncmVwdWxzZScsIHRoaXMuX3BhcmFtcy5pbnRlcmFjdGl2aXR5LmV2ZW50cy5vbmNsaWNrLm1vZGUpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9yZXB1bHNlUGFydGljbGUocGFydGljbGUpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5fcGFyYW1zLnBhcnRpY2xlcy5saW5lX2xpbmtlZC5lbmFibGUgfHwgdGhpcy5fcGFyYW1zLnBhcnRpY2xlcy5tb3ZlLmF0dHJhY3QuZW5hYmxlKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gaSArIDE7IGogPCB0aGlzLl9wYXJhbXMucGFydGljbGVzLmFycmF5Lmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGxpbmsgPSB0aGlzLl9wYXJhbXMucGFydGljbGVzLmFycmF5W2pdO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fcGFyYW1zLnBhcnRpY2xlcy5saW5lX2xpbmtlZC5lbmFibGUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2ludGVyYWN0aW9uLmxpbmtQYXJ0aWNsZXMocGFydGljbGUsIGxpbmssIHRoaXMuX3BhcmFtcywgdGhpcy5fY2FudmFzUGFyYW1zKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3BhcmFtcy5wYXJ0aWNsZXMubW92ZS5hdHRyYWN0LmVuYWJsZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5faW50ZXJhY3Rpb24uYXR0cmFjdFBhcnRpY2xlcyhwYXJ0aWNsZSwgbGluaywgdGhpcy5fcGFyYW1zKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3BhcmFtcy5wYXJ0aWNsZXMubW92ZS5ib3VuY2UpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2ludGVyYWN0aW9uLmJvdW5jZVBhcnRpY2xlcyhwYXJ0aWNsZSwgbGluayk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgcGFydGljbGVzRHJhdygpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLl9jYW52YXNQYXJhbXMuY3R4LmNsZWFyUmVjdCgwLCAwLCB0aGlzLl9jYW52YXNQYXJhbXMud2lkdGgsIHRoaXMuX2NhbnZhc1BhcmFtcy5oZWlnaHQpO1xyXG4gICAgICAgIHRoaXMuX3BhcnRpY2xlc1VwZGF0ZSgpO1xyXG5cclxuICAgICAgICB0aGlzLl9wYXJhbXMucGFydGljbGVzLmFycmF5LmZvckVhY2goKHBhcnRpY2xlOiBQYXJ0aWNsZSkgPT4ge1xyXG4gICAgICAgICAgICBwYXJ0aWNsZS5kcmF3KCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHBhcnRpY2xlc0VtcHR5KCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuX3BhcmFtcy5wYXJ0aWNsZXMuYXJyYXkgPSBbXTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgcmVtb3ZlUGFydGljbGVzKG5iOiBudW1iZXIpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLl9wYXJhbXMucGFydGljbGVzLmFycmF5LnNwbGljZSgwLCBuYik7XHJcblxyXG4gICAgICAgIGlmICghdGhpcy5fcGFyYW1zLnBhcnRpY2xlcy5tb3ZlLmVuYWJsZSkge1xyXG4gICAgICAgICAgICB0aGlzLnBhcnRpY2xlc0RyYXcoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHB1c2hQYXJ0aWNsZXMobmI6IG51bWJlciwgcG9zPzogSU1vdXNlUGFyYW1zKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5fdG1wUGFyYW1zLnB1c2hpbmcgPSB0cnVlO1xyXG5cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5iOyBpKyspIHtcclxuICAgICAgICAgICAgdGhpcy5fcGFyYW1zLnBhcnRpY2xlcy5hcnJheS5wdXNoKFxyXG4gICAgICAgICAgICAgICAgbmV3IFBhcnRpY2xlKFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2NhbnZhc1BhcmFtcyxcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9wYXJhbXMsXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdG1wUGFyYW1zLFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3BhcmFtcy5wYXJ0aWNsZXMuY29sb3IsXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGFyYW1zLnBhcnRpY2xlcy5vcGFjaXR5LnZhbHVlLFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgeDogcG9zID8gcG9zLnBvc194IDogTWF0aC5yYW5kb20oKSAqIHRoaXMuX2NhbnZhc1BhcmFtcy53aWR0aCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgeTogcG9zID8gcG9zLnBvc195IDogTWF0aC5yYW5kb20oKSAqIHRoaXMuX2NhbnZhc1BhcmFtcy5oZWlnaHRcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICApO1xyXG5cclxuICAgICAgICAgICAgaWYgKGkgPT0gbmIgLSAxKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX3BhcmFtcy5wYXJ0aWNsZXMubW92ZS5lbmFibGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcnRpY2xlc0RyYXcoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHRoaXMuX3RtcFBhcmFtcy5wdXNoaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfYnViYmxlUGFydGljbGUocGFydGljbGU6IFBhcnRpY2xlKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX3BhcmFtcy5pbnRlcmFjdGl2aXR5LmV2ZW50cy5vbmhvdmVyLmVuYWJsZSAmJlxyXG4gICAgICAgICAgICBpc0luQXJyYXkoJ2J1YmJsZScsIHRoaXMuX3BhcmFtcy5pbnRlcmFjdGl2aXR5LmV2ZW50cy5vbmhvdmVyLm1vZGUpKSB7XHJcblxyXG4gICAgICAgICAgICBsZXQgZHhfbW91c2U6IG51bWJlciA9IHBhcnRpY2xlLnggLSB0aGlzLl9wYXJhbXMuaW50ZXJhY3Rpdml0eS5tb3VzZS5wb3NfeDtcclxuICAgICAgICAgICAgbGV0IGR5X21vdXNlOiBudW1iZXIgPSBwYXJ0aWNsZS55IC0gdGhpcy5fcGFyYW1zLmludGVyYWN0aXZpdHkubW91c2UucG9zX3k7XHJcbiAgICAgICAgICAgIGxldCBkaXN0X21vdXNlOiBudW1iZXIgPSBNYXRoLnNxcnQoZHhfbW91c2UgKiBkeF9tb3VzZSArIGR5X21vdXNlICogZHlfbW91c2UpO1xyXG4gICAgICAgICAgICBsZXQgcmF0aW86IG51bWJlciA9IDEgLSBkaXN0X21vdXNlIC8gdGhpcy5fcGFyYW1zLmludGVyYWN0aXZpdHkubW9kZXMuYnViYmxlLmRpc3RhbmNlO1xyXG5cclxuICAgICAgICAgICAgbGV0IGluaXQ6ICgpID0+IHZvaWQgPVxyXG4gICAgICAgICAgICAgICAgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlLm9wYWNpdHlfYnViYmxlID0gcGFydGljbGUub3BhY2l0eTtcclxuICAgICAgICAgICAgICAgICAgICBwYXJ0aWNsZS5yYWRpdXNfYnViYmxlID0gcGFydGljbGUucmFkaXVzO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGlmIChkaXN0X21vdXNlIDw9IHRoaXMuX3BhcmFtcy5pbnRlcmFjdGl2aXR5Lm1vZGVzLmJ1YmJsZS5kaXN0YW5jZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJhdGlvID49IDAgJiYgdGhpcy5fcGFyYW1zLmludGVyYWN0aXZpdHkuc3RhdHVzID09ICdtb3VzZW1vdmUnKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9wYXJhbXMuaW50ZXJhY3Rpdml0eS5tb2Rlcy5idWJibGUuc2l6ZSAhPSB0aGlzLl9wYXJhbXMucGFydGljbGVzLnNpemUudmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3BhcmFtcy5pbnRlcmFjdGl2aXR5Lm1vZGVzLmJ1YmJsZS5zaXplID4gdGhpcy5fcGFyYW1zLnBhcnRpY2xlcy5zaXplLnZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgc2l6ZTogbnVtYmVyID0gcGFydGljbGUucmFkaXVzICsgKHRoaXMuX3BhcmFtcy5pbnRlcmFjdGl2aXR5Lm1vZGVzLmJ1YmJsZS5zaXplICogcmF0aW8pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNpemUgPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlLnJhZGl1c19idWJibGUgPSBzaXplO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGRpZjogbnVtYmVyID0gcGFydGljbGUucmFkaXVzIC0gdGhpcy5fcGFyYW1zLmludGVyYWN0aXZpdHkubW9kZXMuYnViYmxlLnNpemU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgc2l6ZTogbnVtYmVyID0gcGFydGljbGUucmFkaXVzIC0gKGRpZiAqIHJhdGlvKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzaXplID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlLnJhZGl1c19idWJibGUgPSBzaXplO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJ0aWNsZS5yYWRpdXNfYnViYmxlID0gMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3BhcmFtcy5pbnRlcmFjdGl2aXR5Lm1vZGVzLmJ1YmJsZS5vcGFjaXR5ICE9IHRoaXMuX3BhcmFtcy5wYXJ0aWNsZXMub3BhY2l0eS52YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fcGFyYW1zLmludGVyYWN0aXZpdHkubW9kZXMuYnViYmxlLm9wYWNpdHkgPiB0aGlzLl9wYXJhbXMucGFydGljbGVzLm9wYWNpdHkudmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBvcGFjaXR5OiBudW1iZXIgPSB0aGlzLl9wYXJhbXMuaW50ZXJhY3Rpdml0eS5tb2Rlcy5idWJibGUub3BhY2l0eSAqIHJhdGlvO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wYWNpdHkgPiBwYXJ0aWNsZS5vcGFjaXR5ICYmIG9wYWNpdHkgPD0gdGhpcy5fcGFyYW1zLmludGVyYWN0aXZpdHkubW9kZXMuYnViYmxlLm9wYWNpdHkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJ0aWNsZS5vcGFjaXR5X2J1YmJsZSA9IG9wYWNpdHk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgb3BhY2l0eTogbnVtYmVyID0gcGFydGljbGUub3BhY2l0eSAtICh0aGlzLl9wYXJhbXMucGFydGljbGVzLm9wYWNpdHkudmFsdWUgLSB0aGlzLl9wYXJhbXMuaW50ZXJhY3Rpdml0eS5tb2Rlcy5idWJibGUub3BhY2l0eSkgKiByYXRpbztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcGFjaXR5IDwgcGFydGljbGUub3BhY2l0eSAmJiBvcGFjaXR5ID49IHRoaXMuX3BhcmFtcy5pbnRlcmFjdGl2aXR5Lm1vZGVzLmJ1YmJsZS5vcGFjaXR5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFydGljbGUub3BhY2l0eV9idWJibGUgPSBvcGFjaXR5O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaW5pdCgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5fcGFyYW1zLmludGVyYWN0aXZpdHkuc3RhdHVzID09ICdtb3VzZWxlYXZlJykge1xyXG4gICAgICAgICAgICAgICAgaW5pdCgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5fcGFyYW1zLmludGVyYWN0aXZpdHkuZXZlbnRzLm9uY2xpY2suZW5hYmxlICYmXHJcbiAgICAgICAgICAgIGlzSW5BcnJheSgnYnViYmxlJywgdGhpcy5fcGFyYW1zLmludGVyYWN0aXZpdHkuZXZlbnRzLm9uY2xpY2subW9kZSkpIHtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLl90bXBQYXJhbXMuYnViYmxlX2NsaWNraW5nKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgZHhfbW91c2U6IG51bWJlciA9IHBhcnRpY2xlLnggLSB0aGlzLl9wYXJhbXMuaW50ZXJhY3Rpdml0eS5tb3VzZS5jbGlja19wb3NfeDtcclxuICAgICAgICAgICAgICAgIGxldCBkeV9tb3VzZTogbnVtYmVyID0gcGFydGljbGUueSAtIHRoaXMuX3BhcmFtcy5pbnRlcmFjdGl2aXR5Lm1vdXNlLmNsaWNrX3Bvc195O1xyXG4gICAgICAgICAgICAgICAgbGV0IGRpc3RfbW91c2U6IG51bWJlciA9IE1hdGguc3FydChkeF9tb3VzZSAqIGR4X21vdXNlICsgZHlfbW91c2UgKiBkeV9tb3VzZSk7XHJcbiAgICAgICAgICAgICAgICBsZXQgdGltZV9zcGVudDogbnVtYmVyID0gKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gdGhpcy5fcGFyYW1zLmludGVyYWN0aXZpdHkubW91c2UuY2xpY2tfdGltZSkgLyAxMDAwO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0aW1lX3NwZW50ID4gdGhpcy5fcGFyYW1zLmludGVyYWN0aXZpdHkubW9kZXMuYnViYmxlLmR1cmF0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdG1wUGFyYW1zLmJ1YmJsZV9kdXJhdGlvbl9lbmQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0aW1lX3NwZW50ID4gdGhpcy5fcGFyYW1zLmludGVyYWN0aXZpdHkubW9kZXMuYnViYmxlLmR1cmF0aW9uICogMikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3RtcFBhcmFtcy5idWJibGVfY2xpY2tpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl90bXBQYXJhbXMuYnViYmxlX2R1cmF0aW9uX2VuZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGxldCBwcm9jZXNzOiBhbnkgPSAoYnViYmxlX3BhcmFtOiBhbnksIHBhcnRpY2xlc19wYXJhbTogYW55LCBwX29ial9idWJibGU6IGFueSwgcF9vYmo6IGFueSwgaWQ6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChidWJibGVfcGFyYW0gIT0gcGFydGljbGVzX3BhcmFtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5fdG1wUGFyYW1zLmJ1YmJsZV9kdXJhdGlvbl9lbmQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkaXN0X21vdXNlIDw9IHRoaXMuX3BhcmFtcy5pbnRlcmFjdGl2aXR5Lm1vZGVzLmJ1YmJsZS5kaXN0YW5jZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBvYmo6IGFueTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocF9vYmpfYnViYmxlICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmogPSBwX29ial9idWJibGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqID0gcF9vYmo7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmogIT0gYnViYmxlX3BhcmFtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCB2YWx1ZTogYW55ID0gcF9vYmogLSAodGltZV9zcGVudCAqIChwX29iaiAtIGJ1YmJsZV9wYXJhbSkgLyB0aGlzLl9wYXJhbXMuaW50ZXJhY3Rpdml0eS5tb2Rlcy5idWJibGUuZHVyYXRpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWQgPT0gJ3NpemUnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFydGljbGUucmFkaXVzX2J1YmJsZSA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWQgPT0gJ29wYWNpdHknKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFydGljbGUub3BhY2l0eV9idWJibGUgPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpZCA9PSAnc2l6ZScpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlLnJhZGl1c19idWJibGUgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlkID09ICdvcGFjaXR5JylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFydGljbGUub3BhY2l0eV9idWJibGUgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocF9vYmpfYnViYmxlICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCB2YWx1ZV90bXA6IGFueSA9IHBfb2JqIC0gKHRpbWVfc3BlbnQgKiAocF9vYmogLSBidWJibGVfcGFyYW0pIC8gdGhpcy5fcGFyYW1zLmludGVyYWN0aXZpdHkubW9kZXMuYnViYmxlLmR1cmF0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZGlmOiBhbnkgPSBidWJibGVfcGFyYW0gLSB2YWx1ZV90bXA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHZhbHVlOiBhbnkgPSBidWJibGVfcGFyYW0gKyBkaWY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlkID09ICdzaXplJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFydGljbGUucmFkaXVzX2J1YmJsZSA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpZCA9PSAnb3BhY2l0eScpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlLm9wYWNpdHlfYnViYmxlID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLl90bXBQYXJhbXMuYnViYmxlX2NsaWNraW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJvY2Vzcyh0aGlzLl9wYXJhbXMuaW50ZXJhY3Rpdml0eS5tb2Rlcy5idWJibGUuc2l6ZSwgdGhpcy5fcGFyYW1zLnBhcnRpY2xlcy5zaXplLnZhbHVlLCBwYXJ0aWNsZS5yYWRpdXNfYnViYmxlLCBwYXJ0aWNsZS5yYWRpdXMsICdzaXplJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJvY2Vzcyh0aGlzLl9wYXJhbXMuaW50ZXJhY3Rpdml0eS5tb2Rlcy5idWJibGUub3BhY2l0eSwgdGhpcy5fcGFyYW1zLnBhcnRpY2xlcy5vcGFjaXR5LnZhbHVlLCBwYXJ0aWNsZS5vcGFjaXR5X2J1YmJsZSwgcGFydGljbGUub3BhY2l0eSwgJ29wYWNpdHknKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF9yZXB1bHNlUGFydGljbGUocGFydGljbGU6IFBhcnRpY2xlKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX3BhcmFtcy5pbnRlcmFjdGl2aXR5LmV2ZW50cy5vbmhvdmVyLmVuYWJsZSAmJlxyXG4gICAgICAgICAgICBpc0luQXJyYXkoJ3JlcHVsc2UnLCB0aGlzLl9wYXJhbXMuaW50ZXJhY3Rpdml0eS5ldmVudHMub25ob3Zlci5tb2RlKSAmJlxyXG4gICAgICAgICAgICB0aGlzLl9wYXJhbXMuaW50ZXJhY3Rpdml0eS5zdGF0dXMgPT0gJ21vdXNlbW92ZScpIHtcclxuXHJcbiAgICAgICAgICAgIGxldCBkeF9tb3VzZTogbnVtYmVyID0gcGFydGljbGUueCAtIHRoaXMuX3BhcmFtcy5pbnRlcmFjdGl2aXR5Lm1vdXNlLnBvc194O1xyXG4gICAgICAgICAgICBsZXQgZHlfbW91c2U6IG51bWJlciA9IHBhcnRpY2xlLnkgLSB0aGlzLl9wYXJhbXMuaW50ZXJhY3Rpdml0eS5tb3VzZS5wb3NfeTtcclxuICAgICAgICAgICAgbGV0IGRpc3RfbW91c2U6IG51bWJlciA9IE1hdGguc3FydChkeF9tb3VzZSAqIGR4X21vdXNlICsgZHlfbW91c2UgKiBkeV9tb3VzZSk7XHJcblxyXG4gICAgICAgICAgICBsZXQgbm9ybVZlYzogYW55ID0geyB4OiBkeF9tb3VzZSAvIGRpc3RfbW91c2UsIHk6IGR5X21vdXNlIC8gZGlzdF9tb3VzZSB9O1xyXG4gICAgICAgICAgICBsZXQgcmVwdWxzZVJhZGl1czogbnVtYmVyID0gdGhpcy5fcGFyYW1zLmludGVyYWN0aXZpdHkubW9kZXMucmVwdWxzZS5kaXN0YW5jZTtcclxuICAgICAgICAgICAgbGV0IHZlbG9jaXR5OiBudW1iZXIgPSAxMDA7XHJcbiAgICAgICAgICAgIGxldCByZXB1bHNlRmFjdG9yOiBudW1iZXIgPSBjbGFtcCgoMSAvIHJlcHVsc2VSYWRpdXMpICogKC0xICogTWF0aC5wb3coZGlzdF9tb3VzZSAvIHJlcHVsc2VSYWRpdXMsIDIpICsgMSkgKiByZXB1bHNlUmFkaXVzICogdmVsb2NpdHksIDAsIDUwKTtcclxuXHJcbiAgICAgICAgICAgIGxldCBwb3MgPSB7XHJcbiAgICAgICAgICAgICAgICB4OiBwYXJ0aWNsZS54ICsgbm9ybVZlYy54ICogcmVwdWxzZUZhY3RvcixcclxuICAgICAgICAgICAgICAgIHk6IHBhcnRpY2xlLnkgKyBub3JtVmVjLnkgKiByZXB1bHNlRmFjdG9yXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9wYXJhbXMucGFydGljbGVzLm1vdmUub3V0X21vZGUgPT0gJ2JvdW5jZScpIHtcclxuICAgICAgICAgICAgICAgIGlmIChwb3MueCAtIHBhcnRpY2xlLnJhZGl1cyA+IDAgJiYgcG9zLnggKyBwYXJ0aWNsZS5yYWRpdXMgPCB0aGlzLl9jYW52YXNQYXJhbXMud2lkdGgpXHJcbiAgICAgICAgICAgICAgICAgICAgcGFydGljbGUueCA9IHBvcy54O1xyXG4gICAgICAgICAgICAgICAgaWYgKHBvcy55IC0gcGFydGljbGUucmFkaXVzID4gMCAmJiBwb3MueSArIHBhcnRpY2xlLnJhZGl1cyA8IHRoaXMuX2NhbnZhc1BhcmFtcy5oZWlnaHQpXHJcbiAgICAgICAgICAgICAgICAgICAgcGFydGljbGUueSA9IHBvcy55O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcGFydGljbGUueCA9IHBvcy54O1xyXG4gICAgICAgICAgICAgICAgcGFydGljbGUueSA9IHBvcy55O1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5fcGFyYW1zLmludGVyYWN0aXZpdHkuZXZlbnRzLm9uY2xpY2suZW5hYmxlICYmXHJcbiAgICAgICAgICAgIGlzSW5BcnJheSgncmVwdWxzZScsIHRoaXMuX3BhcmFtcy5pbnRlcmFjdGl2aXR5LmV2ZW50cy5vbmNsaWNrLm1vZGUpKSB7XHJcblxyXG4gICAgICAgICAgICBpZiAoIXRoaXMuX3RtcFBhcmFtcy5yZXB1bHNlX2ZpbmlzaCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fdG1wUGFyYW1zLnJlcHVsc2VfY291bnQrKztcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLl90bXBQYXJhbXMucmVwdWxzZV9jb3VudCA9PSB0aGlzLl9wYXJhbXMucGFydGljbGVzLmFycmF5Lmxlbmd0aClcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl90bXBQYXJhbXMucmVwdWxzZV9maW5pc2ggPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5fdG1wUGFyYW1zLnJlcHVsc2VfY2xpY2tpbmcpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgcmVwdWxzZVJhZGl1czogbnVtYmVyID0gTWF0aC5wb3codGhpcy5fcGFyYW1zLmludGVyYWN0aXZpdHkubW9kZXMucmVwdWxzZS5kaXN0YW5jZSAvIDYsIDMpO1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCBkeDogbnVtYmVyID0gdGhpcy5fcGFyYW1zLmludGVyYWN0aXZpdHkubW91c2UuY2xpY2tfcG9zX3ggLSBwYXJ0aWNsZS54O1xyXG4gICAgICAgICAgICAgICAgbGV0IGR5OiBudW1iZXIgPSB0aGlzLl9wYXJhbXMuaW50ZXJhY3Rpdml0eS5tb3VzZS5jbGlja19wb3NfeSAtIHBhcnRpY2xlLnk7XHJcbiAgICAgICAgICAgICAgICBsZXQgZDogbnVtYmVyID0gZHggKiBkeCArIGR5ICogZHk7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IGZvcmNlOiBudW1iZXIgPSAtcmVwdWxzZVJhZGl1cyAvIGQgKiAxO1xyXG5cclxuICAgICAgICAgICAgICAgIGxldCBwcm9jZXNzOiAoKSA9PiB2b2lkID1cclxuICAgICAgICAgICAgICAgICAgICAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBmOiBudW1iZXIgPSBNYXRoLmF0YW4yKGR5LCBkeCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlLnZ4ID0gZm9yY2UgKiBNYXRoLmNvcyhmKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFydGljbGUudnkgPSBmb3JjZSAqIE1hdGguc2luKGYpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fcGFyYW1zLnBhcnRpY2xlcy5tb3ZlLm91dF9tb2RlID09ICdib3VuY2UnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgcG9zOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeDogbnVtYmVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHk6IG51bWJlcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHg6IHBhcnRpY2xlLnggKyBwYXJ0aWNsZS52eCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeTogcGFydGljbGUueSArIHBhcnRpY2xlLnZ5XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBvcy54ICsgcGFydGljbGUucmFkaXVzID4gdGhpcy5fY2FudmFzUGFyYW1zLndpZHRoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlLnZ4ID0gLXBhcnRpY2xlLnZ4O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocG9zLnggLSBwYXJ0aWNsZS5yYWRpdXMgPCAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlLnZ4ID0gLXBhcnRpY2xlLnZ4O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBvcy55ICsgcGFydGljbGUucmFkaXVzID4gdGhpcy5fY2FudmFzUGFyYW1zLmhlaWdodClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJ0aWNsZS52eSA9IC1wYXJ0aWNsZS52eTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBvcy55IC0gcGFydGljbGUucmFkaXVzIDwgMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJ0aWNsZS52eSA9IC1wYXJ0aWNsZS52eTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGQgPD0gcmVwdWxzZVJhZGl1cykge1xyXG4gICAgICAgICAgICAgICAgICAgIHByb2Nlc3MoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLl90bXBQYXJhbXMucmVwdWxzZV9jbGlja2luZyA9PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHBhcnRpY2xlLnZ4ID0gcGFydGljbGUudnhfaTtcclxuICAgICAgICAgICAgICAgICAgICBwYXJ0aWNsZS52eSA9IHBhcnRpY2xlLnZ5X2k7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfZ3JhYlBhcnRpY2xlKHBhcnRpY2xlOiBQYXJ0aWNsZSk6IHZvaWQge1xyXG4gICAgICAgIGxldCB7IGludGVyYWN0aXZpdHksIHBhcnRpY2xlcyB9ID0gdGhpcy5fcGFyYW1zO1xyXG5cclxuICAgICAgICBpZiAoaW50ZXJhY3Rpdml0eS5ldmVudHMub25ob3Zlci5lbmFibGUgJiZcclxuICAgICAgICAgICAgaW50ZXJhY3Rpdml0eS5zdGF0dXMgPT0gJ21vdXNlbW92ZScpIHtcclxuXHJcbiAgICAgICAgICAgIGxldCBkeF9tb3VzZTogbnVtYmVyID0gcGFydGljbGUueCAtIGludGVyYWN0aXZpdHkubW91c2UucG9zX3g7XHJcbiAgICAgICAgICAgIGxldCBkeV9tb3VzZTogbnVtYmVyID0gcGFydGljbGUueSAtIGludGVyYWN0aXZpdHkubW91c2UucG9zX3k7XHJcbiAgICAgICAgICAgIGxldCBkaXN0X21vdXNlOiBudW1iZXIgPSBNYXRoLnNxcnQoZHhfbW91c2UgKiBkeF9tb3VzZSArIGR5X21vdXNlICogZHlfbW91c2UpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGRpc3RfbW91c2UgPD0gaW50ZXJhY3Rpdml0eS5tb2Rlcy5ncmFiLmRpc3RhbmNlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IHsgZ3JhYiB9ID0gaW50ZXJhY3Rpdml0eS5tb2RlcztcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgb3BhY2l0eV9saW5lOiBudW1iZXIgPSBncmFiLmxpbmVfbGlua2VkLm9wYWNpdHkgLSAoZGlzdF9tb3VzZSAvICgxIC8gZ3JhYi5saW5lX2xpbmtlZC5vcGFjaXR5KSkgLyBncmFiLmRpc3RhbmNlO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChvcGFjaXR5X2xpbmUgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGNvbG9yX2xpbmU6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcjogbnVtYmVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBnOiBudW1iZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGI6IG51bWJlcjtcclxuICAgICAgICAgICAgICAgICAgICB9ID0gcGFydGljbGVzLmxpbmVfbGlua2VkLmNvbG9yX3JnYl9saW5lO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBsZXQgeyByLCBnLCBiIH0gPSBjb2xvcl9saW5lO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2NhbnZhc1BhcmFtcy5jdHguc3Ryb2tlU3R5bGUgPSBgcmdiYSggJHtyfSwgJHtnfSwgJHtifSwgJHtvcGFjaXR5X2xpbmV9IClgO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2NhbnZhc1BhcmFtcy5jdHgubGluZVdpZHRoID0gcGFydGljbGVzLmxpbmVfbGlua2VkLndpZHRoO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jYW52YXNQYXJhbXMuY3R4LmJlZ2luUGF0aCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2NhbnZhc1BhcmFtcy5jdHgubW92ZVRvKHBhcnRpY2xlLngsIHBhcnRpY2xlLnkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2NhbnZhc1BhcmFtcy5jdHgubGluZVRvKGludGVyYWN0aXZpdHkubW91c2UucG9zX3gsIGludGVyYWN0aXZpdHkubW91c2UucG9zX3kpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2NhbnZhc1BhcmFtcy5jdHguc3Ryb2tlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2FudmFzUGFyYW1zLmN0eC5jbG9zZVBhdGgoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufSJdfQ==