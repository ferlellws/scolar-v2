export var hexToRgb = function (hex) {
    var shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
    hex = hex.replace(shorthandRegex, function (m, r, g, b) {
        return r + r + g + g + b + b;
    });
    var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
    return result ? {
        r: parseInt(result[1], 16),
        g: parseInt(result[2], 16),
        b: parseInt(result[3], 16)
    } : null;
};
export var clamp = function (number, min, max) {
    return Math.min(Math.max(number, min), max);
};
export var isInArray = function (value, array) {
    return array.indexOf(value) > -1;
};
export var deepExtend = function (destination, source) {
    for (var property in source) {
        if (source[property] &&
            source[property].constructor &&
            source[property].constructor === Object) {
            destination[property] = destination[property] || {};
            deepExtend(destination[property], source[property]);
        }
        else {
            destination[property] = source[property];
        }
    }
    return destination;
};
export var getColor = function (colorObject) {
    var color = {};
    if (typeof (colorObject) == 'object') {
        if (colorObject instanceof Array) {
            var selectedColor = colorObject[Math.floor(Math.random() * colorObject.length)];
            color.rgb = hexToRgb(selectedColor);
        }
        else {
            var r = colorObject.r, g = colorObject.g, b = colorObject.b;
            if (r !== undefined && g !== undefined && b !== undefined) {
                color.rgb = { r: r, g: g, b: b };
            }
            else {
                var h = colorObject.h, s = colorObject.s, l = colorObject.l;
                if (h !== undefined && g !== undefined && b !== undefined) {
                    color.hsl = { h: h, s: s, l: l };
                }
            }
        }
    }
    else if (colorObject == 'random') {
        color.rgb = {
            r: (Math.floor(Math.random() * 255) + 1),
            g: (Math.floor(Math.random() * 255) + 1),
            b: (Math.floor(Math.random() * 255) + 1)
        };
    }
    else if (typeof (colorObject) == 'string') {
        color.rgb = hexToRgb(colorObject);
    }
    return color;
};
export var getDefaultParams = function () {
    return {
        particles: {
            number: {
                value: 100,
                density: {
                    enable: true,
                    value_area: 800
                }
            },
            color: {
                value: '#FFF'
            },
            shape: {
                type: 'circle',
                stroke: {
                    width: 0,
                    color: '#000000'
                },
                polygon: {
                    nb_sides: 5
                },
                image: {
                    src: '',
                    width: 100,
                    height: 100
                }
            },
            opacity: {
                value: 0.5,
                random: false,
                anim: {
                    enable: true,
                    speed: 1,
                    opacity_min: 0.1,
                    sync: false
                }
            },
            size: {
                value: 3,
                random: true,
                anim: {
                    enable: false,
                    speed: 40,
                    size_min: 0,
                    sync: false
                }
            },
            line_linked: {
                enable: true,
                distance: 150,
                color: '#FFF',
                opacity: 0.6,
                width: 1,
                shadow: {
                    enable: false,
                    blur: 5,
                    color: 'lime'
                }
            },
            move: {
                enable: true,
                speed: 3,
                direction: 'none',
                random: false,
                straight: false,
                out_mode: 'out',
                bounce: true,
                attract: {
                    enable: false,
                    rotateX: 3000,
                    rotateY: 3000
                }
            },
            array: []
        },
        interactivity: {
            detect_on: 'canvas',
            events: {
                onhover: {
                    enable: true,
                    mode: 'grab'
                },
                onclick: {
                    enable: true,
                    mode: 'push'
                },
                resize: true
            },
            modes: {
                grab: {
                    distance: 200,
                    line_linked: {
                        opacity: 1
                    }
                },
                bubble: {
                    distance: 200,
                    size: 80,
                    duration: 0.4
                },
                repulse: {
                    distance: 200,
                    duration: 0.4
                },
                push: {
                    particles_nb: 4
                },
                remove: {
                    particles_nb: 2
                }
            },
            mouse: {}
        },
        retina_detect: true
    };
};
export function loadImg(params, tmp) {
    var particles = params.particles;
    tmp.img_error = undefined;
    if (particles.shape.type == 'image' && particles.shape.image.src != '') {
        if (tmp.img_type == 'svg') {
            var xhr_1 = new XMLHttpRequest();
            xhr_1.open('GET', particles.shape.image.src);
            xhr_1.onreadystatechange = function (data) {
                if (xhr_1.readyState == 4) {
                    if (xhr_1.status == 200) {
                        tmp.source_svg = data.currentTarget.response;
                        if (tmp.source_svg == undefined) {
                            var check = void 0;
                            tmp.checkAnimFrame = requestAnimationFrame(check);
                        }
                    }
                    else {
                        tmp.img_error = true;
                        throw "Error : image not found";
                    }
                }
            };
            xhr_1.send();
        }
        else {
            var img_1 = new Image();
            img_1.addEventListener('load', function () {
                tmp.img_obj = img_1;
                cancelAnimationFrame(tmp.checkAnimFrame);
            });
            img_1.src = particles.shape.image.src;
        }
    }
    else {
        tmp.img_error = true;
        throw "Error : no image.src";
    }
}
export function createSvgImg(particle, tmp) {
    var svgXml = tmp.source_svg;
    var rgbHex = /#([0-9A-F]{3,6})/gi;
    var coloredSvgXml = svgXml.replace(rgbHex, function (m, r, g, b) {
        var color_value;
        if (particle.color.rgb) {
            var _a = particle.color.rgb, r_1 = _a.r, g_1 = _a.g, b_1 = _a.b;
            color_value = "rgba( " + r_1 + ", " + g_1 + ", " + b_1 + ", " + particle.opacity + " )";
        }
        else {
            var _b = particle.color.hsl, h = _b.h, s = _b.s, l = _b.l;
            color_value = "rgba( " + h + ", " + s + ", " + l + ", " + particle.opacity + " )";
        }
        return color_value;
    });
    var svg = new Blob([coloredSvgXml], {
        type: 'image/svg+xml;charset=utf-8'
    });
    var DOMURL = window.URL || window;
    var url = DOMURL.createObjectURL(svg);
    var img = new Image();
    img.addEventListener('load', function () {
        particle.img.obj = img;
        particle.img.loaded = true;
        DOMURL.revokeObjectURL(url);
        tmp.count_svg++;
    });
    img.src = url;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gtcGFydGljbGUvIiwic291cmNlcyI6WyJsaWIvbW9kZWxzL3V0aWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQWVBLE1BQU0sQ0FBQyxJQUFNLFFBQVEsR0FDakIsVUFBQyxHQUFHO0lBQ0EsSUFBSSxjQUFjLEdBQUcsa0NBQWtDLENBQUM7SUFDeEQsR0FBRyxHQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUMsY0FBYyxFQUFFLFVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQztRQUN6QyxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ2pDLENBQUMsQ0FBQyxDQUFDO0lBQ0gsSUFBSSxNQUFNLEdBQUcsMkNBQTJDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ25FLE9BQU8sTUFBTSxDQUFDLENBQUMsQ0FBQztRQUNaLENBQUMsRUFBRSxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQztRQUMxQixDQUFDLEVBQUUsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUM7UUFDMUIsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDO0tBQzdCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztBQUNiLENBQUMsQ0FBQztBQUVOLE1BQU0sQ0FBQyxJQUFNLEtBQUssR0FDZCxVQUFDLE1BQU0sRUFBRSxHQUFHLEVBQUUsR0FBRztJQUNiLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztBQUNoRCxDQUFDLENBQUM7QUFFTixNQUFNLENBQUMsSUFBTSxTQUFTLEdBQ2xCLFVBQUMsS0FBSyxFQUFF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QUFHLEdBQVMsSUFBSSxJQUFJLENBQUMsQ0FBQyxhQUFhLENBQUMsRUFBRTtRQUN0QyxJQUFJLEVBQUUsNkJBQTZCO0tBQ3RDLENBQUMsQ0FBQztJQUVILElBQUksTUFBTSxHQUFRLE1BQU0sQ0FBQyxHQUFHLElBQUksTUFBTSxDQUFDO0lBQ3ZDLElBQUksR0FBRyxHQUFRLE1BQU0sQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLENBQUM7SUFFM0MsSUFBSSxHQUFHLEdBQUcsSUFBSSxLQUFLLEVBQUUsQ0FBQztJQUN0QixHQUFHLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxFQUFFO1FBQ3pCLFFBQVEsQ0FBQyxHQUFHLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQztRQUN2QixRQUFRLENBQUMsR0FBRyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUM7UUFDM0IsTUFBTSxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUM1QixHQUFHLENBQUMsU0FBUyxFQUFFLENBQUM7SUFDcEIsQ0FBQyxDQUFDLENBQUM7SUFDSCxHQUFHLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQztBQUNsQixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSVBhcmFtcywgSVRtcFBhcmFtcyB9IGZyb20gXCIuL2ludGVyZmFjZXNcIjtcclxuaW1wb3J0IHsgUGFydGljbGUgfSBmcm9tIFwiLi9wYXJ0aWNsZVwiO1xyXG5cclxuZXhwb3J0IHR5cGUgUkdCID0ge1xyXG5cdHI6IG51bWJlcjtcclxuXHRnOiBudW1iZXI7XHJcblx0YjogbnVtYmVyO1xyXG59O1xyXG5cclxuZXhwb3J0IHR5cGUgSFNMID0ge1xyXG5cdGg6IG51bWJlcjtcclxuXHRzOiBudW1iZXI7XHJcblx0bDogbnVtYmVyO1xyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGhleFRvUmdiOiAoaGV4OiBzdHJpbmcpID0+IFJHQiA9XHJcbiAgICAoaGV4KSA9PiB7XHJcbiAgICAgICAgbGV0IHNob3J0aGFuZFJlZ2V4ID0gL14jPyhbYS1mXFxkXSkoW2EtZlxcZF0pKFthLWZcXGRdKSQvaTtcclxuICAgICAgICBoZXggPSBoZXgucmVwbGFjZShzaG9ydGhhbmRSZWdleCwgKG0sIHIsIGcsIGIpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHIgKyByICsgZyArIGcgKyBiICsgYjtcclxuICAgICAgICB9KTtcclxuICAgICAgICBsZXQgcmVzdWx0ID0gL14jPyhbYS1mXFxkXXsyfSkoW2EtZlxcZF17Mn0pKFthLWZcXGRdezJ9KSQvaS5leGVjKGhleCk7XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdCA/IHtcclxuICAgICAgICAgICAgcjogcGFyc2VJbnQocmVzdWx0WzFdLCAxNiksXHJcbiAgICAgICAgICAgIGc6IHBhcnNlSW50KHJlc3VsdFsyXSwgMTYpLFxyXG4gICAgICAgICAgICBiOiBwYXJzZUludChyZXN1bHRbM10sIDE2KVxyXG4gICAgICAgIH0gOiBudWxsO1xyXG4gICAgfTtcclxuXHJcbmV4cG9ydCBjb25zdCBjbGFtcDogKG51bWJlcjogbnVtYmVyLCBtaW46IG51bWJlciwgbWF4OiBudW1iZXIpID0+IG51bWJlciA9XHJcbiAgICAobnVtYmVyLCBtaW4sIG1heCkgPT4ge1xyXG4gICAgICAgIHJldHVybiBNYXRoLm1pbihNYXRoLm1heChudW1iZXIsIG1pbiksIG1heCk7XHJcbiAgICB9O1xyXG5cclxuZXhwb3J0IGNvbnN0IGlzSW5BcnJheTogKHZhbHVlOiBhbnksIGFycmF5OiBhbnkpID0+IGJvb2xlYW4gPVxyXG4gICAgKHZhbHVlLCBhcnJheSkgPT4ge1xyXG4gICAgICAgIHJldHVybiBhcnJheS5pbmRleE9mKHZhbHVlKSA+IC0xO1xyXG4gICAgfTtcclxuXHJcbmV4cG9ydCBjb25zdCBkZWVwRXh0ZW5kOiAoZGVzdGluYXRpb246IGFueSwgc291cmNlOiBhbnkpID0+IGFueSA9XHJcbiAgICBmdW5jdGlvbiAoZGVzdGluYXRpb24sIHNvdXJjZSkge1xyXG4gICAgICAgIGZvciAobGV0IHByb3BlcnR5IGluIHNvdXJjZSkge1xyXG4gICAgICAgICAgICBpZiAoc291cmNlW3Byb3BlcnR5XSAmJlxyXG4gICAgICAgICAgICAgICAgc291cmNlW3Byb3BlcnR5XS5jb25zdHJ1Y3RvciAmJlxyXG4gICAgICAgICAgICAgICAgc291cmNlW3Byb3BlcnR5XS5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbltwcm9wZXJ0eV0gPSBkZXN0aW5hdGlvbltwcm9wZXJ0eV0gfHwge307XHJcbiAgICAgICAgICAgICAgICBkZWVwRXh0ZW5kKGRlc3RpbmF0aW9uW3Byb3BlcnR5XSwgc291cmNlW3Byb3BlcnR5XSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbltwcm9wZXJ0eV0gPSBzb3VyY2VbcHJvcGVydHldO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBkZXN0aW5hdGlvbjtcclxuICAgIH07XHJcblxyXG5leHBvcnQgY29uc3QgZ2V0Q29sb3I6IChjb2xvck9iamVjdDogYW55KSA9PiB7IHJnYj86IFJHQiwgaHNsPzogSFNMIH0gPVxyXG4gICAgKGNvbG9yT2JqZWN0KSA9PiB7XHJcbiAgICAgICAgbGV0IGNvbG9yOiB7IHJnYj86IFJHQiwgaHNsPzogSFNMIH0gPSB7fTtcclxuICAgICAgICBpZiAodHlwZW9mIChjb2xvck9iamVjdCkgPT0gJ29iamVjdCcpIHtcclxuICAgICAgICAgICAgaWYgKGNvbG9yT2JqZWN0IGluc3RhbmNlb2YgQXJyYXkpIHtcclxuICAgICAgICAgICAgICAgIGxldCBzZWxlY3RlZENvbG9yOiBzdHJpbmcgPSBjb2xvck9iamVjdFtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBjb2xvck9iamVjdC5sZW5ndGgpXTtcclxuICAgICAgICAgICAgICAgIGNvbG9yLnJnYiA9IGhleFRvUmdiKHNlbGVjdGVkQ29sb3IpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbGV0IHsgciwgZywgYiB9ID0gY29sb3JPYmplY3Q7XHJcbiAgICAgICAgICAgICAgICBpZiAociAhPT0gdW5kZWZpbmVkICYmIGcgIT09IHVuZGVmaW5lZCAmJiBiICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb2xvci5yZ2IgPSB7IHIsIGcsIGIgfTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHsgaCwgcywgbCB9ID0gY29sb3JPYmplY3Q7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGggIT09IHVuZGVmaW5lZCAmJiBnICE9PSB1bmRlZmluZWQgJiYgYiAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yLmhzbCA9IHsgaCwgcywgbCB9O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSBpZiAoY29sb3JPYmplY3QgPT0gJ3JhbmRvbScpIHtcclxuICAgICAgICAgICAgY29sb3IucmdiID0ge1xyXG4gICAgICAgICAgICAgICAgcjogKE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDI1NSkgKyAxKSxcclxuICAgICAgICAgICAgICAgIGc6IChNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyNTUpICsgMSksXHJcbiAgICAgICAgICAgICAgICBiOiAoTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMjU1KSArIDEpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiAoY29sb3JPYmplY3QpID09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIGNvbG9yLnJnYiA9IGhleFRvUmdiKGNvbG9yT2JqZWN0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGNvbG9yO1xyXG4gICAgfTtcclxuXHJcbmV4cG9ydCBjb25zdCBnZXREZWZhdWx0UGFyYW1zOiAoKSA9PiBJUGFyYW1zID1cclxuICAgICgpID0+IHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBwYXJ0aWNsZXM6IHtcclxuICAgICAgICAgICAgICAgIG51bWJlcjoge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiAxMDAsXHJcbiAgICAgICAgICAgICAgICAgICAgZGVuc2l0eToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmFibGU6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlX2FyZWE6IDgwMFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBjb2xvcjoge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiAnI0ZGRidcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBzaGFwZToge1xyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdjaXJjbGUnLFxyXG4gICAgICAgICAgICAgICAgICAgIHN0cm9rZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6ICcjMDAwMDAwJ1xyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgcG9seWdvbjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuYl9zaWRlczogNVxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgaW1hZ2U6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3JjOiAnJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDEwMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAxMDBcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgb3BhY2l0eToge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiAwLjUsXHJcbiAgICAgICAgICAgICAgICAgICAgcmFuZG9tOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICBhbmltOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuYWJsZTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3BlZWQ6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHlfbWluOiAwLjEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN5bmM6IGZhbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHNpemU6IHtcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogMyxcclxuICAgICAgICAgICAgICAgICAgICByYW5kb206IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgYW5pbToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmFibGU6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzcGVlZDogNDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpemVfbWluOiAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzeW5jOiBmYWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBsaW5lX2xpbmtlZDoge1xyXG4gICAgICAgICAgICAgICAgICAgIGVuYWJsZTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICBkaXN0YW5jZTogMTUwLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbG9yOiAnI0ZGRicsXHJcbiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMC42LFxyXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgIHNoYWRvdzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmFibGU6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBibHVyOiA1LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogJ2xpbWUnXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIG1vdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICBlbmFibGU6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgc3BlZWQ6IDMsXHJcbiAgICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uOiAnbm9uZScsXHJcbiAgICAgICAgICAgICAgICAgICAgcmFuZG9tOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICBzdHJhaWdodDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgb3V0X21vZGU6ICdvdXQnLFxyXG4gICAgICAgICAgICAgICAgICAgIGJvdW5jZTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICBhdHRyYWN0OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuYWJsZTogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvdGF0ZVg6IDMwMDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvdGF0ZVk6IDMwMDBcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgYXJyYXk6IFtdXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGludGVyYWN0aXZpdHk6IHtcclxuICAgICAgICAgICAgICAgIGRldGVjdF9vbjogJ2NhbnZhcycsXHJcbiAgICAgICAgICAgICAgICBldmVudHM6IHtcclxuICAgICAgICAgICAgICAgICAgICBvbmhvdmVyOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuYWJsZTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbW9kZTogJ2dyYWInXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBvbmNsaWNrOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuYWJsZTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbW9kZTogJ3B1c2gnXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICByZXNpemU6IHRydWVcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBtb2Rlczoge1xyXG4gICAgICAgICAgICAgICAgICAgIGdyYWI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzdGFuY2U6IDIwMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGluZV9saW5rZWQ6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDFcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgYnViYmxlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3RhbmNlOiAyMDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpemU6IDgwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogMC40XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICByZXB1bHNlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3RhbmNlOiAyMDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAwLjRcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHB1c2g6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFydGljbGVzX25iOiA0XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICByZW1vdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFydGljbGVzX25iOiAyXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIG1vdXNlOiB7fVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICByZXRpbmFfZGV0ZWN0OiB0cnVlXHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gbG9hZEltZyhwYXJhbXM6IElQYXJhbXMsIHRtcDogSVRtcFBhcmFtcykge1xyXG4gICAgbGV0IHsgcGFydGljbGVzIH0gPSBwYXJhbXM7XHJcblxyXG4gICAgdG1wLmltZ19lcnJvciA9IHVuZGVmaW5lZDtcclxuXHJcbiAgICBpZiAocGFydGljbGVzLnNoYXBlLnR5cGUgPT0gJ2ltYWdlJyAmJiBwYXJ0aWNsZXMuc2hhcGUuaW1hZ2Uuc3JjICE9ICcnKSB7XHJcbiAgICAgICAgaWYgKHRtcC5pbWdfdHlwZSA9PSAnc3ZnJykge1xyXG4gICAgICAgICAgICBsZXQgeGhyOiBYTUxIdHRwUmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xyXG4gICAgICAgICAgICB4aHIub3BlbignR0VUJywgcGFydGljbGVzLnNoYXBlLmltYWdlLnNyYyk7XHJcbiAgICAgICAgICAgIHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSAoZGF0YTogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoeGhyLnJlYWR5U3RhdGUgPT0gNCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh4aHIuc3RhdHVzID09IDIwMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0bXAuc291cmNlX3N2ZyA9IGRhdGEuY3VycmVudFRhcmdldC5yZXNwb25zZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRtcC5zb3VyY2Vfc3ZnID09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNoZWNrOiBhbnk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bXAuY2hlY2tBbmltRnJhbWUgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoY2hlY2spO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG1wLmltZ19lcnJvciA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IFwiRXJyb3IgOiBpbWFnZSBub3QgZm91bmRcIjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHhoci5zZW5kKCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbGV0IGltZzogSFRNTEltYWdlRWxlbWVudCA9IG5ldyBJbWFnZSgpO1xyXG4gICAgICAgICAgICBpbWcuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRtcC5pbWdfb2JqID0gaW1nO1xyXG4gICAgICAgICAgICAgICAgY2FuY2VsQW5pbWF0aW9uRnJhbWUodG1wLmNoZWNrQW5pbUZyYW1lKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGltZy5zcmMgPSBwYXJ0aWNsZXMuc2hhcGUuaW1hZ2Uuc3JjO1xyXG4gICAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdG1wLmltZ19lcnJvciA9IHRydWU7XHJcbiAgICAgICAgdGhyb3cgXCJFcnJvciA6IG5vIGltYWdlLnNyY1wiO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlU3ZnSW1nKHBhcnRpY2xlOiBQYXJ0aWNsZSwgdG1wOiBJVG1wUGFyYW1zKTogdm9pZCB7XHJcbiAgICBsZXQgc3ZnWG1sOiBzdHJpbmcgPSB0bXAuc291cmNlX3N2ZztcclxuICAgIGxldCByZ2JIZXg6IFJlZ0V4cCA9IC8jKFswLTlBLUZdezMsNn0pL2dpO1xyXG4gICAgbGV0IGNvbG9yZWRTdmdYbWw6IHN0cmluZyA9IHN2Z1htbC5yZXBsYWNlKHJnYkhleCwgKG0sIHIsIGcsIGIpID0+IHtcclxuICAgICAgICBsZXQgY29sb3JfdmFsdWU6IHN0cmluZztcclxuICAgICAgICBpZiAocGFydGljbGUuY29sb3IucmdiKSB7XHJcbiAgICAgICAgICAgIGxldCB7IHIsIGcsIGIgfSA9IHBhcnRpY2xlLmNvbG9yLnJnYjtcclxuICAgICAgICAgICAgY29sb3JfdmFsdWUgPSBgcmdiYSggJHtyfSwgJHtnfSwgJHtifSwgJHtwYXJ0aWNsZS5vcGFjaXR5fSApYDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBsZXQgeyBoLCBzLCBsIH0gPSBwYXJ0aWNsZS5jb2xvci5oc2w7XHJcbiAgICAgICAgICAgIGNvbG9yX3ZhbHVlID0gYHJnYmEoICR7aH0sICR7c30sICR7bH0sICR7cGFydGljbGUub3BhY2l0eX0gKWA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBjb2xvcl92YWx1ZTtcclxuICAgIH0pO1xyXG5cclxuICAgIGxldCBzdmc6IEJsb2IgPSBuZXcgQmxvYihbY29sb3JlZFN2Z1htbF0sIHtcclxuICAgICAgICB0eXBlOiAnaW1hZ2Uvc3ZnK3htbDtjaGFyc2V0PXV0Zi04J1xyXG4gICAgfSk7XHJcblxyXG4gICAgbGV0IERPTVVSTDogYW55ID0gd2luZG93LlVSTCB8fCB3aW5kb3c7XHJcbiAgICBsZXQgdXJsOiBhbnkgPSBET01VUkwuY3JlYXRlT2JqZWN0VVJMKHN2Zyk7XHJcblxyXG4gICAgbGV0IGltZyA9IG5ldyBJbWFnZSgpO1xyXG4gICAgaW1nLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCAoKSA9PiB7XHJcbiAgICAgICAgcGFydGljbGUuaW1nLm9iaiA9IGltZztcclxuICAgICAgICBwYXJ0aWNsZS5pbWcubG9hZGVkID0gdHJ1ZTtcclxuICAgICAgICBET01VUkwucmV2b2tlT2JqZWN0VVJMKHVybCk7XHJcbiAgICAgICAgdG1wLmNvdW50X3N2ZysrO1xyXG4gICAgfSk7XHJcbiAgICBpbWcuc3JjID0gdXJsO1xyXG59Il19